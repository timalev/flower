"use strict";(self.webpackChunkflowervalley=self.webpackChunkflowervalley||[]).push([[560],{2560:(q,g,c)=>{c.r(g),c.d(g,{DiscountModule:()=>$});var b=c(9808),d=c(2535),f=c(4128),C=c(1135),t=c(5e3),x=c(4472),M=c(8563),m=c(9783),v=c(3710),_=c(6526),a=c(3075),r=c(845),s=c(4255),D=c(7780),h=c(1208),T=c(6497);function P(n,l){1&n&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"\u0421\u0443\u043c\u043c\u0430"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"\u0421\u043a\u0438\u0434\u043a\u0430"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f"),t.qZA()())}function w(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"p-inputNumber",20),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().$implicit.sum=i}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.sum)("min",1)("required",!0)}}function O(n,l){if(1&n&&(t._uU(0),t.ALo(1,"priceConverter")),2&n){const e=t.oxw().$implicit;t.hij(" ",t.lcZ(1,1,e.sum)," ")}}function Z(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"p-inputNumber",20),t.NdJ("ngModelChange",function(i){return t.CHM(e),t.oxw().$implicit.discount=i}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.discount)("min",1)("required",!0)}}function A(n,l){if(1&n&&t._uU(0),2&n){const e=t.oxw().$implicit;t.hij(" ",e.discount,"% ")}}function k(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw().onRowEditInit(i)}),t.qZA()}}function y(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",22),t.NdJ("click",function(){t.CHM(e);const i=t.oxw().$implicit;return t.oxw().onRowEditSave(i)}),t.qZA()}}function E(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",23),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(),u=i.$implicit,p=i.rowIndex;return t.oxw().onRowEditCancel(u,p)}),t.qZA()}}function N(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2).$implicit;return t.oxw().deleteItem(i.id)}),t.qZA()}}function I(n,l){if(1&n&&(t.TgZ(0,"div",24),t.YNc(1,N,1,0,"button",25),t.qZA()),2&n){const e=t.oxw().editing;t.xp6(1),t.Q6J("ngIf",!e)}}function J(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"tr",10)(1,"td")(2,"p-cellEditor"),t.YNc(3,w,1,3,"ng-template",11),t.YNc(4,O,2,3,"ng-template",12),t.qZA()(),t.TgZ(5,"td")(6,"p-cellEditor"),t.YNc(7,Z,1,3,"ng-template",11),t.YNc(8,A,1,1,"ng-template",12),t.qZA()(),t.TgZ(9,"td")(10,"div",13)(11,"p-checkbox",14),t.NdJ("ngModelChange",function(i){return!!(t.CHM(e).$implicit.addToPriceList=i)})("ngModelChange",function(){const u=t.CHM(e).$implicit;return t.oxw().saveDiscount(u)}),t.qZA()()(),t.TgZ(12,"td")(13,"div")(14,"div",15),t.YNc(15,k,1,0,"button",16),t.YNc(16,y,1,0,"button",17),t.YNc(17,E,1,0,"button",18),t.qZA(),t.YNc(18,I,2,1,"div",19),t.qZA()()()}if(2&n){const e=l.$implicit,o=l.editing,i=t.oxw();t.Q6J("pEditableRow",e),t.xp6(11),t.Q6J("ngModel",!!e.addToPriceList)("binary",!0)("disabled",i.isCheckBoxesDisabled&&!e.addToPriceList),t.xp6(4),t.Q6J("ngIf",!o),t.xp6(1),t.Q6J("ngIf",o),t.xp6(1),t.Q6J("ngIf",o),t.xp6(1),t.Q6J("ngIf",!o)}}function L(n,l){if(1&n){const e=t.EpF();t.TgZ(0,"p-button",27),t.NdJ("onClick",function(){return t.CHM(e),t.oxw().navigateToAddDiscount()}),t.qZA()}}const R=[{path:"",component:(()=>{class n{constructor(e,o,i,u){this.discountService=e,this.catalogService=o,this.router=i,this.ms=u,this.discount=[],this.catalog=[],this.selectedCategories=[],this.clonedDiscount={},this.isLoading=!1,this.requestProcessed=!1}ngOnInit(){this.isLoading=!0;const e=[this.catalogService.getItems(!0),this.discountService.getItems()];(0,f.D)(e).subscribe(([o,i])=>{this.discount=i.sort((u,p)=>u.sum-p.sum),this.catalog=o,this.selectedCategories=this.catalog.filter(u=>!u.hasNoDiscount),this.isLoading=!1})}deleteItem(e){this.isLoading=!0,this.discountService.deleteItem(e).subscribe(()=>{const o=this.discount.findIndex(i=>i.id===e);this.discount.splice(o,1),this.isLoading=!1})}navigateToAddDiscount(){this.router.navigate(["admin/add/discount"])}onRowEditInit(e){this.clonedDiscount[e.id]=Object.assign({},e)}onRowEditSave(e){this.isLoading=!0,this.discountService.updateItem(e).subscribe(()=>{delete this.clonedDiscount[e.id],this.isLoading=!1})}onRowEditCancel(e,o){this.discount[o]=this.clonedDiscount[e.id],delete this.clonedDiscount[e.id]}saveCategories(){this.requestProcessed=!0;const e=new C.X(this.catalog.length);this.catalog.map(o=>{const i=new FormData;o.hasNoDiscount=!this.selectedCategories.find(u=>u.id===o.id),i.append("hasNoDiscount",o.hasNoDiscount.toString()),this.catalogService.updateItem(i,o.id).subscribe(()=>{e.next(e.value-1)})}),e.subscribe(o=>{o||(this.requestProcessed=!1,this.ms.add({severity:"success",summary:"\u0414\u0430\u043d\u043d\u044b\u0435 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u044b",detail:"\u041f\u0440\u0438\u043c\u0435\u043d\u0435\u043d\u0438\u0435 \u0441\u043a\u0438\u0434\u043e\u043a \u0440\u0430\u0441\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e"}))})}saveDiscount(e){this.discountService.updateItem(Object.assign({},e)).subscribe(()=>{this.ms.add(e.addToPriceList?{severity:"success",summary:"\u0421\u043a\u0438\u0434\u043a\u0430 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430",detail:`\u0421\u043a\u0438\u0434\u043a\u0430 \u0432 ${e.discount}% \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0430 \u043a \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044e \u0432 \u043f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442\u0435`}:{severity:"success",summary:"\u0421\u043a\u0438\u0434\u043a\u0430 \u043e\u0442\u043e\u0437\u0432\u0430\u043d\u0430",detail:`\u0421\u043a\u0438\u0434\u043a\u0430 \u0432 ${e.discount}% \u043e\u0442\u043e\u0437\u0432\u0430\u043d\u0430 \u043e\u0442 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u0432 \u043f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442\u0435`})})}get isCheckBoxesDisabled(){return!(this.discount.filter(e=>e.addToPriceList).length<2)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.r),t.Y36(M.a),t.Y36(d.F0),t.Y36(m.ez))},n.\u0275cmp=t.Xpm({type:n,selectors:[["flower-valley-discount"]],decls:12,vars:10,consts:[["headerTitle","\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u0441\u043a\u0438\u0434\u043e\u043a \u043e\u0442 \u0441\u0443\u043c\u043c\u044b \u0437\u0430\u043a\u0430\u0437\u0430",3,"isAdmin","buttonTemplate"],[1,"flex","align-items-center","mb-2"],[1,"p-float-label","mb-0","mr-2","w-12"],["styleClass","w-12","inputId","discount","dataKey","id","optionLabel","name","emptyMessage","\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439 \u043d\u0435\u0442","selectedItemsLabel","\u0412\u044b\u0431\u0440\u0430\u043d\u043e \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439: {0}",3,"disabled","options","ngModel","maxSelectedLabels","filter","ngModelChange"],["for","discount"],["label","\u0421\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c",3,"loading","onClick"],["dataKey","id","editMode","row",3,"value","loading"],["pTemplate","header"],["pTemplate","body"],["addDiscountButton",""],[3,"pEditableRow"],["pTemplate","input"],["pTemplate","output"],[1,"p-field-checkbox"],[3,"ngModel","binary","disabled","ngModelChange"],[1,"edit"],["pButton","","type","button","pInitEditableRow","","icon","pi pi-pencil ","class","p-button-rounded p-button-text p-button-success",3,"click",4,"ngIf"],["pButton","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-text p-button-success p-mr-2",3,"click",4,"ngIf"],["pButton","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-text p-button-danger",3,"click",4,"ngIf"],["class","trash",4,"ngIf"],[3,"ngModel","min","required","ngModelChange"],["pButton","","type","button","pInitEditableRow","","icon","pi pi-pencil ",1,"p-button-rounded","p-button-text","p-button-success",3,"click"],["pButton","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-text","p-button-success","p-mr-2",3,"click"],["pButton","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-text","p-button-danger",3,"click"],[1,"trash"],["pButton","","type","button","pInitEditableRow","","icon","pi pi pi-trash ","class","p-button-rounded p-button-text p-button-danger",3,"click",4,"ngIf"],["pButton","","type","button","pInitEditableRow","","icon","pi pi pi-trash ",1,"p-button-rounded","p-button-text","p-button-danger",3,"click"],["label","\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0441\u043a\u0438\u0434\u043a\u0443",3,"onClick"]],template:function(e,o){if(1&e&&(t.TgZ(0,"flower-valley-container",0)(1,"div",1)(2,"span",2)(3,"p-multiSelect",3),t.NdJ("ngModelChange",function(u){return o.selectedCategories=u}),t.qZA(),t.TgZ(4,"label",4),t._uU(5,"\u041f\u0440\u0438\u043c\u0435\u043d\u044f\u0435\u0442\u0441\u044f \u043a \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f\u043c"),t.qZA()(),t.TgZ(6,"p-button",5),t.NdJ("onClick",function(){return o.saveCategories()}),t.qZA()(),t.TgZ(7,"p-table",6),t.YNc(8,P,9,0,"ng-template",7),t.YNc(9,J,19,8,"ng-template",8),t.qZA()(),t.YNc(10,L,1,0,"ng-template",null,9,t.W1O)),2&e){const i=t.MAs(11);t.Q6J("isAdmin",!0)("buttonTemplate",i),t.xp6(3),t.Q6J("disabled",o.requestProcessed)("options",o.catalog)("ngModel",o.selectedCategories)("maxSelectedLabels",4)("filter",!1),t.xp6(3),t.Q6J("loading",o.requestProcessed),t.xp6(1),t.Q6J("value",o.discount)("loading",o.isLoading)}},directives:[v.e,_.NU,a.JJ,a.On,r.zx,s.iA,m.jx,s.D$,s.YL,D.R,a.Q7,h.XZ,b.O5,r.Hq,s.Pv,s.U1,s.wT],pipes:[T.K],styles:[".p-float-label[_ngcontent-%COMP%]{position:relative;margin-bottom:10px;width:100%}.p-float-label[_ngcontent-%COMP%]     .p-inputtext, .p-float-label[_ngcontent-%COMP%]     .p-inputtextarea{width:100%;padding:20px 22px}.p-float-label[_ngcontent-%COMP%]     .p-inputwrapper-focus~label, .p-float-label[_ngcontent-%COMP%]     .p-inputwrapper-filled~label{top:15px;left:22px}.p-float-label[_ngcontent-%COMP%]     .p-inputwrapper-focus input, .p-float-label[_ngcontent-%COMP%]     .p-inputwrapper-filled input{padding-bottom:15px;padding-top:25px}.p-float-label[_ngcontent-%COMP%]     input:focus, .p-float-label[_ngcontent-%COMP%]     input.p-filled, .p-float-label[_ngcontent-%COMP%]     textarea:focus, .p-float-label[_ngcontent-%COMP%]     textarea.p-filled{padding-bottom:15px;padding-top:25px}.p-float-label[_ngcontent-%COMP%]     input:focus~label, .p-float-label[_ngcontent-%COMP%]     input.p-filled~label, .p-float-label[_ngcontent-%COMP%]     textarea:focus~label, .p-float-label[_ngcontent-%COMP%]     textarea.p-filled~label{top:15px;left:22px}.p-float-label[_ngcontent-%COMP%]     .p-dropdown-label{padding-bottom:15px;padding-top:25px}.p-float-label[_ngcontent-%COMP%]     .p-multiselect-label{padding:25px 22px 15px}.p-field-checkbox[_ngcontent-%COMP%]{margin-bottom:10px}.p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox-box{box-shadow:none}.p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox .p-checkbox-box.p-highlight{background-color:#8fb600;border-color:#8fb600}.p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox:not(.p-checkbox-disabled) .p-checkbox-box:hover, .p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox:not(.p-checkbox-disabled) .p-checkbox-box.p-focus{border-color:#8fb600}.p-field-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-left:10px;font-weight:500;font-size:16px;line-height:100%}.p-field-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover{cursor:pointer}  .p-button{background-color:#8fb600;border-color:#8fb600;font-weight:500;font-size:18px;line-height:110%}  .p-button:enabled:hover,   .p-button:enabled:active{background-color:#6d8a00;border-color:#6d8a00}  .p-fileupload-choose:not(.p-disabled):hover{background-color:#6d8a00;border-color:#6d8a00}.img[_ngcontent-%COMP%]{position:relative}.img[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.editor-danger[_ngcontent-%COMP%]     .p-editor-container .p-editor-content.ql-snow{border:1px solid #e24c4c}.editor-danger[_ngcontent-%COMP%]     .p-editor-container .p-editor-content.ql-snow .ql-editor.ql-blank:before{color:#e24c4c}.photos-error[_ngcontent-%COMP%]{color:#e24c4c;padding-bottom:10px;font-weight:500;font-size:16px;line-height:100%}[_nghost-%COMP%]     .p-datatable-tbody td:nth-child(1), [_nghost-%COMP%]     .p-datatable-tbody td:nth-child(2){width:232px}[_nghost-%COMP%]     .p-datatable-tbody td   input{width:200px}[_nghost-%COMP%]     .p-datatable-tbody td:last-child>div{display:flex}[_nghost-%COMP%]     .p-datatable-tbody td:last-child>div .edit{color:#8fb600}[_nghost-%COMP%]     .p-datatable-tbody td:last-child>div .trash{margin-left:20px;color:#ea3b15}"]}),n})()}];let S=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[d.Bz.forChild(R)],d.Bz]}),n})();var B=c(4466),F=c(3275),Y=c(2993);let $=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[b.ez,S,B.f,r.hJ,s.U$,Y.L,a.u5,F.D,_.q4,h.nD]]}),n})()}}]);