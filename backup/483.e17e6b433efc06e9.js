(self.webpackChunkflowervalley=self.webpackChunkflowervalley||[]).push([[483],{6483:(ne,A,R)=>{"use strict";function U(u,m,d,f,g,b,p){try{var P=u[b](p),F=P.value}catch(t){return void d(t)}P.done?m(F):Promise.resolve(F).then(f,g)}function x(u){return function(){var m=this,d=arguments;return new Promise(function(f,g){var b=u.apply(m,d);function p(F){U(b,f,g,p,P,"next",F)}function P(F){U(b,f,g,p,P,"throw",F)}p(void 0)})}}R.d(A,{o:()=>q});var c=R(5e3),B=R(3659),Z=R.n(B),D=R(7582),O=(()=>{return(u=O||(O={}))[u.Up=1]="Up",u[u.Down=3]="Down",u[u.Right=6]="Right",u[u.Left=8]="Left",u[u.UpMirrored=2]="UpMirrored",u[u.DownMirrored=4]="DownMirrored",u[u.LeftMirrored=5]="LeftMirrored",u[u.RightMirrored=7]="RightMirrored",u[u.Default=0]="Default",u[u.NotJpeg=-1]="NotJpeg",u[u.NotDefined=-2]="NotDefined",O;var u})();class E{}E.getOrientation=u=>new Promise((m,d)=>{try{const f=new FileReader;f.onload=()=>{const g=new DataView(f.result);if(!g.byteLength||65496!==g.getUint16(0,!1))return m(O.NotDefined);const b=g.byteLength;let p=2;for(;p<b;){const P=g.getUint16(p,!1);if(p+=2,65505===P){if(1165519206!==g.getUint32(p+=2,!1))return m(O.NotJpeg);const F=18761===g.getUint16(p+=6,!1);p+=g.getUint32(p+4,F);const t=g.getUint16(p,F);p+=2;for(let e=0;e<t;e++)if(274===g.getUint16(p+12*e,F))return m(g.getUint16(p+12*e+8,F))}else{if(65280!=(65280&P))break;p+=g.getUint16(p,!1)}}return m(O.NotJpeg)},f.readAsArrayBuffer(u)}catch(f){return d(O.Default)}}),E.uploadFile=(u,m=!0,d=!1)=>new Promise(function(f,g){const b=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),p=/iPad|iPhone|iPod/i.test(navigator.userAgent);Promise.resolve(b||p).then(P=>P?E.generateUploadInputNative(window.document,m,d):E.generateUploadInputRenderer(u,m,d)).then(P=>{const F=P?Array.from(P):[],t=F.map(r=>E.getOrientation(r)),e=F.map(r=>E.fileToDataURL(r));let n=[];Promise.all(t).then(r=>(n=r,Promise.all(e))).then(r=>{const a=r.map((l,v)=>({image:l.dataUrl,orientation:n[v],fileName:l.fileName}));f(m?a:a[0])})}).catch(P=>g(P))}),E.fileToDataURL=u=>new Promise((m,d)=>{const f=new FileReader;f.onload=g=>{m({dataUrl:g.target.result,fileName:u.name})};try{f.readAsDataURL(u)}catch(g){d(`ngx-image-compress - probably no file have been selected: ${g}`)}}),E.generateUploadInputRenderer=(u,m=!0,d=!1)=>{let f=!1;return new Promise((g,b)=>{const p=u.createElement("input");u.setStyle(p,"display","none"),u.setProperty(p,"type","file"),u.setProperty(p,"accept","image/*"),m&&u.setProperty(p,"multiple","true"),u.listen(p,"click",P=>{P.target.value=""}),u.listen(p,"change",P=>{f=!0,g(P.target.files)}),d&&window.addEventListener("focus",()=>{setTimeout(()=>{f||b(new Error("file upload on blur - no file selected"))},300)},{once:!0}),p.click()})},E.generateUploadInputNative=(u,m=!0,d=!1)=>{let f=!1;return new Promise((g,b)=>{const p=u.createElement("input");p.id="upload-input"+new Date,p.style.display="none",p.setAttribute("type","file"),p.setAttribute("accept","image/*"),m&&p.setAttribute("multiple","true"),u.body.appendChild(p),p.addEventListener("change",()=>{f=!0,g(p.files),u.body.removeChild(u.getElementById(p.id))},{once:!0}),d&&window.addEventListener("focus",()=>{setTimeout(()=>{!f&&u.getElementById(p.id)&&(b(new Error("file upload on blur - no file selected")),u.body.removeChild(u.getElementById(p.id)))},300)},{once:!0}),p.click()})},E.compress=(u,m,d,f=50,g=50,b=0,p=0)=>new Promise(function(P,F){g/=100,f/=100;const t=new Image;t.onload=()=>{const e=d.createElement("canvas"),n=e.getContext("2d");if(!n)return F("No canvas context available");let r=t.naturalWidth,a=t.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(m===O.Right||m===O.Left)){const o=r;r=a,a=o}f=Math.min(f,b?b/r:1,p?p/a:1),e.width=r*f,e.height=a*f;const j=Math.PI/180;CSS.supports("image-orientation","from-image")||m===O.Up?n.drawImage(t,0,0,e.width,e.height):m===O.Right?(n.save(),n.rotate(90*j),n.translate(0,-e.width),n.drawImage(t,0,0,e.height,e.width),n.restore()):m===O.Left?(n.save(),n.rotate(-90*j),n.translate(-e.width,0),n.drawImage(t,0,0,e.height,e.width),n.restore()):m===O.Down?(n.save(),n.rotate(180*j),n.translate(-e.width,-e.height),n.drawImage(t,0,0,e.width,e.height),n.restore()):n.drawImage(t,0,0,e.width,e.height);const L=u.substr(5,u.split(";")[0].length-5),y=e.toDataURL(L,g);P(y)},t.onerror=e=>F(e),t.src=u}),E.byteCount=u=>encodeURI(u).split(/%..|./).length-1,E.getImageMaxSize=(u,m,d,f=!1)=>(0,D.mG)(void 0,void 0,void 0,function*(){const b=F=>(F/1024/1024).toFixed(2);m&&console.debug("NgxImageCompress - Opening upload window");let P,p=yield E.uploadFile(d,!1,f);for(let F=0;F<10;F++){const t=E.byteCount(p.image);P=yield E.compress(p.image,p.orientation,d,50,100);const e=E.byteCount(P);if(console.debug("NgxImageCompress -","Compression from",b(t),"MB to",b(e),"MB"),e>=t)throw 0===F?(m&&console.debug("NgxImageCompress -","File can't be reduced at all - returning the original",b(t),"MB large"),p.image):(m&&console.debug("NgxImageCompress -","File can't be reduced more - returning the best we can, which is ",b(t),"MB large"),p.image);if(e<1024*u*1024)return m&&console.debug("NgxImageCompress -","Here your file",b(e),"MB large"),P;if(9===F)throw m&&console.debug("NgxImageCompress -","File can't reach the desired size after",10,"tries. Returning file ",b(t),"MB large"),p.image;m&&console.debug("NgxImageCompress -","Reached",b(e),"MB large. Trying another time after",F+1,"times"),p.image=P}throw m&&console.debug("NgxImageCompress - Unexpected error"),""});let z=(()=>{class u{constructor(d){this.DOC_ORIENTATION=O,this.render=d.createRenderer(null,null)}byteCount(d){return E.byteCount(d)}getOrientation(d){return E.getOrientation(d)}uploadFile(){return E.uploadFile(this.render,!1)}uploadMultipleFiles(){return E.uploadFile(this.render,!0)}uploadFileOrReject(){return E.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return E.uploadFile(this.render,!0,!0)}compressFile(d,f,g=50,b=50,p=0,P=0){return E.compress(d,f,this.render,g,b,p,P)}uploadAndGetImageWithMaxSize(d=1,f=!1,g=!1){return E.getImageMaxSize(d,f,this.render,g)}}return u.\u0275fac=function(d){return new(d||u)(c.LFG(c.FYo))},u.\u0275prov=c.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();var H=R(6805),Q=R(2340),T=R(2260),Y=R(1208),J=R(3075),k=R(27),G=R(9808),V=R(9047),X=R(8850),_=R(845);const I=["fileUpload"];function K(u,m){1&u&&(c.TgZ(0,"div",7),c._UZ(1,"flower-valley-loader",8),c.qZA())}function $(u,m){if(1&u){const d=c.EpF();c.TgZ(0,"div",11),c._UZ(1,"p-image",12),c.TgZ(2,"p-button",13),c.NdJ("onClick",function(){const b=c.CHM(d).index;return c.oxw(2).removeImage(b)}),c.qZA()()}if(2&u){const d=m.$implicit;c.xp6(1),c.Q6J("src",d)}}function N(u,m){if(1&u&&(c.TgZ(0,"div",9),c.YNc(1,$,3,1,"div",10),c.qZA()),2&u){const d=c.oxw();c.xp6(1),c.Q6J("ngForOf",d.localCompressedUrl)}}let q=(()=>{class u{constructor(d,f){this.imageCompress=d,this.staticData=f,this.multi=!0,this.label="\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f",this.showOnlyButton=!1,this.autoUpload=!1,this.uploaded=new c.vpe,this.localUrl=[],this.localCompressedUrl=[],this.compressedFiles=[],this.isWatermark=!1,this.isUploadingProcess=!1,this.initialFiles=[]}uploadFiles(d){var f=this;return x(function*(){var g;f.initialFiles=d,d.map(b=>{f.genLocalUrl(b)}),null===(g=f.fileUpload)||void 0===g||g.clear()})()}setWatermark(d,f){return Z()([d,f||"assets/images/logo.png"]).blob((g,b)=>{let p=g.getContext("2d");p.save(),p.globalAlpha=.7;const P=.25*g.height;return p.drawImage(b,10,10,P,.8237*P),p.restore(),g})}removeImage(d){this.localUrl.splice(d,1),this.localCompressedUrl.splice(d,1),this.compressedFiles.splice(d,1),this.uploaded.emit(this.compressedFiles)}genLocalUrl(d){this.isUploadingProcess=!0;const f=d.name,g=new FileReader;g.onload=b=>{this.localUrl=!this.multi&&this.localUrl.length?[b.target.result]:this.localUrl.concat(b.target.result),this.compressFile(b.target.result,f)},g.readAsDataURL(d)}compressFile(d,f){var g=this;return x(function*(){g.imageCompress.compressFile(d,-1,50,100).then(function(){var p=x(function*(P){let F=new File([g.dataURItoBlob(P.split(",")[1])],f);if(g.isWatermark){const t=g.staticData.getLogo(),{img:e}=yield function W(u,m){const d="object"==typeof m;return new Promise((f,g)=>{let p,b=!1;u.subscribe({next:P=>{p=P,b=!0},error:g,complete:()=>{b?f(p):d?f(m.defaultValue):g(new H.K)}})})}(t),n=yield Q.N.production?g.setWatermark(F,e):g.setWatermark(F),r=new FileReader;r.onload=a=>{F=new File([n],f),g.uploadEmit(F,a.target.result)},r.readAsDataURL(n)}else g.uploadEmit(F,P)});return function(P){return p.apply(this,arguments)}}())})()}uploadEmit(d,f){!this.multi&&this.localUrl.length?(this.localCompressedUrl=[f],this.compressedFiles=[d]):(this.localCompressedUrl=this.localCompressedUrl.concat(f),this.compressedFiles=this.compressedFiles.concat(d)),this.autoUpload?this.compressedFiles.length===this.initialFiles.length&&(this.isUploadingProcess=!1,this.uploaded.emit(this.compressedFiles),this.localUrl=[],this.localCompressedUrl=[],this.compressedFiles=[]):(this.isUploadingProcess=!1,this.uploaded.emit(this.compressedFiles))}dataURItoBlob(d){const f=window.atob(d),g=new ArrayBuffer(f.length),b=new Uint8Array(g);for(let p=0;p<f.length;p++)b[p]=f.charCodeAt(p);return new Blob([b],{type:"image/jpeg"})}}return u.\u0275fac=function(d){return new(d||u)(c.Y36(z),c.Y36(T.v))},u.\u0275cmp=c.Xpm({type:u,selectors:[["flower-valley-files-upload"]],viewQuery:function(d,f){if(1&d&&c.Gf(I,5),2&d){let g;c.iGM(g=c.CRH())&&(f.fileUpload=g.first)}},inputs:{multi:"multi",label:"label",showOnlyButton:"showOnlyButton",autoUpload:"autoUpload"},outputs:{uploaded:"uploaded"},features:[c._Bn([z])],decls:8,vars:9,consts:[[1,"p-field-checkbox","mb-2"],["inputId","isWatermark",3,"ngModel","binary","ngModelChange"],["for","isWatermark"],["styleClass","mb-2","mode","basic",3,"customUpload","disabled","chooseLabel","multiple","auto","uploadHandler"],["fileUpload",""],["class","loader",4,"ngIf"],["class","grid mt-2",4,"ngIf"],[1,"loader"],["appearance","small"],[1,"grid","mt-2"],["class","img col-3",4,"ngFor","ngForOf"],[1,"img","col-3"],["styleClass","w-12","imageClass","w-12",3,"src"],["styleClass","p-button-danger","icon","pi pi-trash",3,"onClick"]],template:function(d,f){1&d&&(c.TgZ(0,"div",0)(1,"p-checkbox",1),c.NdJ("ngModelChange",function(b){return f.isWatermark=b}),c.qZA(),c.TgZ(2,"label",2),c._uU(3,"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432\u043e\u0434\u044f\u043d\u043e\u0439 \u0437\u043d\u0430\u043a"),c.qZA()(),c.TgZ(4,"p-fileUpload",3,4),c.NdJ("uploadHandler",function(b){return f.uploadFiles(b.files)}),c.qZA(),c.YNc(6,K,2,0,"div",5),c.YNc(7,N,2,1,"div",6)),2&d&&(c.xp6(1),c.Q6J("ngModel",f.isWatermark)("binary",!0),c.xp6(3),c.Q6J("customUpload",!0)("disabled",f.isUploadingProcess)("chooseLabel",f.label)("multiple",f.multi)("auto",!0),c.xp6(2),c.Q6J("ngIf",f.isUploadingProcess),c.xp6(1),c.Q6J("ngIf",!f.showOnlyButton&&f.localCompressedUrl.length))},directives:[Y.XZ,J.JJ,J.On,k.p,G.O5,V.R,G.sg,X.E,_.zx],styles:[".loader[_ngcontent-%COMP%]{max-width:300px}.img[_ngcontent-%COMP%]{position:relative}.img[_ngcontent-%COMP%]   p-button[_ngcontent-%COMP%]{position:absolute;top:0;left:0}.p-field-checkbox[_ngcontent-%COMP%]{margin-bottom:10px;display:flex;align-items:center}.p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox-box{box-shadow:none}.p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox .p-checkbox-box.p-highlight{background-color:#8fb600;border-color:#8fb600}.p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox:not(.p-checkbox-disabled) .p-checkbox-box:hover, .p-field-checkbox[_ngcontent-%COMP%]     .p-checkbox:not(.p-checkbox-disabled) .p-checkbox-box.p-focus{border-color:#8fb600}.p-field-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{margin-left:10px;font-weight:500;font-size:16px;line-height:100%}.p-field-checkbox[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]:hover{cursor:pointer}"]}),u})()},3659:ne=>{window,ne.exports=function(A){var R={};function U(x){if(R[x])return R[x].exports;var c=R[x]={i:x,l:!1,exports:{}};return A[x].call(c.exports,c,c.exports,U),c.l=!0,c.exports}return U.m=A,U.c=R,U.d=function(x,c,B){U.o(x,c)||Object.defineProperty(x,c,{enumerable:!0,get:B})},U.r=function(x){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(x,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(x,"__esModule",{value:!0})},U.t=function(x,c){if(1&c&&(x=U(x)),8&c||4&c&&"object"==typeof x&&x&&x.__esModule)return x;var B=Object.create(null);if(U.r(B),Object.defineProperty(B,"default",{enumerable:!0,value:x}),2&c&&"string"!=typeof x)for(var Z in x)U.d(B,Z,function(D){return x[D]}.bind(null,Z));return B},U.n=function(x){var c=x&&x.__esModule?function(){return x.default}:function(){return x};return U.d(c,"a",c),c},U.o=function(x,c){return Object.prototype.hasOwnProperty.call(x,c)},U.p="",U(U.s=0)}([function(A,R,U){A.exports=U(1).default},function(A,R,U){"use strict";U.r(R);var x={};U.r(x),U.d(x,"atPos",function(){return I}),U.d(x,"lowerRight",function(){return K}),U.d(x,"upperRight",function(){return $}),U.d(x,"lowerLeft",function(){return N}),U.d(x,"upperLeft",function(){return q}),U.d(x,"center",function(){return u});var c={};function Z(o){return o}function D(o){return(D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(s){return typeof s}:function(s){return s&&"function"==typeof Symbol&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s})(o)}function ee(o){return"string"===D(o)?z:o instanceof Image?Z:H}function E(o,i){for(var s=[],h=0;h<o.length;h++){var C=o[h],S=ee(C)(C,i);s.push(S)}return Promise.all(s)}function z(o,i){var s=new Image;return"function"==typeof i&&i(s),new Promise(function(h){s.onload=function(){return h(s)},s.src=o})}function H(o){var i=new FileReader;return new Promise(function(s){var h=new Image;i.onloadend=function(){return function O(o,i,s){o.onload=function(){return s(o)},o.src=i}(h,i.result,s)},i.readAsDataURL(o)})}function W(o,i){var s=new Image;return"function"==typeof i&&(s.onload=i),s.src=o,s}function Y(o,i){return o.map(function(s){return function T(o,i){return function Q(o,i){var s=i.getContext("2d");return i.width=o.width,i.height=o.height,s.drawImage(o,0,0),i}(o,i.pop())}(s,i)})}U.r(c),U.d(c,"atPos",function(){return m}),U.d(c,"lowerRight",function(){return d}),U.d(c,"lowerLeft",function(){return f}),U.d(c,"upperRight",function(){return g}),U.d(c,"upperLeft",function(){return b}),U.d(c,"center",function(){return p});var k=/^data:([^;]+);base64,(.*)$/;function V(o){return window.atob(o)}function X(o){for(var i=o.length,s=new Uint8Array(i),h=0;h<i;h++)s[h]=o.charCodeAt(h);return s}var _=function B(){for(var o=arguments.length,i=new Array(o),s=0;s<o;s++)i[s]=arguments[s];return function(h){return i.reduce(function(C,w){return w.call(null,C)},h)}}(function G(o){return k.exec(o).slice(1)},function(o){return[V(o[1]),o[0]]},function(o){return new Blob([X(o[0])],{type:o[1]})});function I(o,i,s){return s||(s=1),function(h,C){var w=h.getContext("2d");return w.save(),w.globalAlpha=s,w.drawImage(C,o(h,C),i(h,C)),w.restore(),h}}function K(o){return I(function(i,s){return i.width-(s.width+10)},function(i,s){return i.height-(s.height+10)},o)}function $(o){return I(function(i,s){return i.width-(s.width+10)},function(i,s){return 10},o)}function N(o){return I(function(i,s){return 10},function(i,s){return i.height-(s.height+10)},o)}function q(o){return I(function(i,s){return 10},function(i,s){return 10},o)}function u(o){return I(function(i,s){return(i.width-s.width)/2},function(i,s){return(i.height-s.height)/2},o)}function m(o,i,s,h,C,w){return w||(w=1),function(S){var M=S.getContext("2d");M.save(),M.globalAlpha=w,M.fillStyle=C,M.font=h;var te=M.measureText(s);return M.fillText(s,o(S,te,M),i(S,te,M)),M.restore(),S}}function d(o,i,s,h,C){return m(function(w,S){return w.width-(S.width+10)},function(w){return C||w.height-10},o,i,s,h)}function f(o,i,s,h,C){return m(function(){return 10},function(w){return C||w.height-10},o,i,s,h)}function g(o,i,s,h,C){return m(function(w,S){return w.width-(S.width+10)},function(){return C||20},o,i,s,h)}function b(o,i,s,h,C){return m(function(){return 10},function(){return C||20},o,i,s,h)}function p(o,i,s,h,C){return m(function(w,S,M){return M.textAlign="center",w.width/2},function(w,S,M){return M.textBaseline="middle",w.height/2},o,i,s,h)}var P=x,F=c;function t(o,i){return{canvas:o.apply(null,i),sources:i}}function e(o,i){return Object.keys(i).forEach(function(h){return o[h]=i[h]}),o}var l=function r(){var o=[];return{pop:function(){return 0===this.length&&o.push(document.createElement("canvas")),o.pop()},get length(){return o.length},release:function(s){s.getContext("2d").clearRect(0,0,s.width,s.height),o.push(s)},clear:function(){o.splice(0,o.length)},get elements(){return o}}}();U.d(R,"default",function(){return y});var v={init:function(){},type:"image/png",encoderOptions:.92};function j(o){return e(function n(o){return e({},o)}(v),o)}function L(o,i,s){var C=o.sources,w=function J(o){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:"image/png",encoderOptions:.92};return o.toDataURL(i.type,i.encoderOptions)}(o.canvas,s);return C.forEach(i.release),w}function y(o){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,h=j(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});return s||(s=E(o,h.init)),{dataUrl:function(w){var S=this.then(function(M){return Y(M,l)}).then(function(M){return t(w,M)}).then(function(M){return L(M,l,{type:h.type,encoderOptions:h.encoderOptions})});return y(o,h,S)},load:function(w,S){var M=this.then(function(te){return E([te].concat(w),S)});return y(w,h,M)},render:function(){var w=this.then(function(S){return E([S])});return y(o,h,w)},blob:function(w){var S=this.dataUrl(w).then(_);return y(o,h,S)},image:function(w){var S=this.dataUrl(w).then(W);return y(o,h,S)},then:function(){for(var w=arguments.length,S=new Array(w),M=0;M<w;M++)S[M]=arguments[M];return s.then.apply(s,S)}}}y.image=P,y.text=F,y.destroy=function(){return l.clear()}}])},7582:(ne,A,R)=>{"use strict";function Z(t,e,n,r){var v,a=arguments.length,l=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(t,e,n,r);else for(var j=t.length-1;j>=0;j--)(v=t[j])&&(l=(a<3?v(l):a>3?v(e,n,l):v(e,n))||l);return a>3&&l&&Object.defineProperty(e,n,l),l}function W(t,e,n,r){return new(n||(n=Promise))(function(l,v){function j(o){try{y(r.next(o))}catch(i){v(i)}}function L(o){try{y(r.throw(o))}catch(i){v(i)}}function y(o){o.done?l(o.value):function a(l){return l instanceof n?l:new n(function(v){v(l)})}(o.value).then(j,L)}y((r=r.apply(t,e||[])).next())})}R.d(A,{gn:()=>Z,mG:()=>W}),"function"==typeof SuppressedError&&SuppressedError}}]);