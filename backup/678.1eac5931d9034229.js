"use strict";(self.webpackChunkflowervalley=self.webpackChunkflowervalley||[]).push([[678],{3878:(Z,x,a)=>{a.d(x,{Y:()=>C});var h=a(2340),g=a(5e3),t=a(520),d=a(2260);let C=(()=>{class s{constructor(c,r){this.http=c,this.staticData=r,this.baseUrl=h.N.baseUrl,this.apiUrl="mails",this.signature="",this.individualText="",this.businessText="",this.businessNotificationText="",r.getMailTexts().subscribe(l=>{this.individualText=l.individualText,this.businessText=l.businessText,this.signature=l.signature,this.businessNotificationText=l.businessNotificationText})}sendIndividualMail(c,r){return this.sendCopyToAdmin(!1,c,r),c.append("sign",this.signature),c.append("text",this.individualText),this.http.post(`${this.baseUrl}/${this.apiUrl}/individual`,c)}sendBusinessMail(c,r,l){return this.sendCopyToAdmin(!0,c,r,l),c.append("sign",this.signature),c.append("text",this.businessText),this.http.post(`${this.baseUrl}/${this.apiUrl}/business`,c)}sendBusinessNotificationMail(c){this.sendAdminNotificationMail(c).subscribe();const r=new FormData;return r.append("orderId",c.id.toString()),r.append("email",c.clientEmail),r.append("sign",this.signature),r.append("text",this.businessNotificationText),this.http.post(`${this.baseUrl}/${this.apiUrl}/business-notification`,r)}sendEditOrderMail(c){return this.http.post(`${this.baseUrl}/${this.apiUrl}/edit-order`,c)}sendAdminMail(c){return this.http.post(`${this.baseUrl}/${this.apiUrl}/admin`,c)}sendAdminNotificationMail(c){const r=new FormData;return r.append("orderId",c.id.toString()),r.append("contactName",c.clientName),r.append("contactPhone",c.clientPhone),r.append("contactEmail",c.clientEmail),r.append("contactAddress",c.clientAddress),this.http.post(`${this.baseUrl}/${this.apiUrl}/admin-notification`,r)}sendPricesMail(c){return c.append("sign",this.signature),this.http.post(`${this.baseUrl}/${this.apiUrl}/price-list`,c)}sendCopyToAdmin(c,r,l,b){const _=new FormData;_.append("isBusiness",`${c}`),_.append("sum",l.orderSum.toString()),_.append("orderId",l.id.toString()),_.append("accountNumber",l.accountNumber||""),_.append("clientName",b||l.clientName),_.append("contactName",l.clientName),_.append("contactPhone",l.clientPhone),_.append("contactEmail",l.clientEmail),_.append("contactAddress",l.clientAddress);const T=r.get("file");T&&_.append("file",T),this.sendAdminMail(_).subscribe()}}return s.\u0275fac=function(c){return new(c||s)(g.LFG(t.eN),g.LFG(d.v))},s.\u0275prov=g.Yz7({token:s,factory:s.\u0275fac,providedIn:"root"}),s})()},7613:(Z,x,a)=>{a.d(x,{F:()=>t});var h=a(3075);function g(d){!d||(d instanceof h.NI?d.markAsDirty():Object.keys(d.controls).map(C=>{const s=d.get(C);(null==s?void 0:s.invalid)&&(s instanceof h.Oe&&s.controls.map(f=>{g(f)}),s instanceof h.cw&&g(s),null==s||s.markAsDirty())}))}function t(d){return!!(null==d?void 0:d.invalid)&&(g(d),!0)}},7678:(Z,x,a)=>{a.r(x),a.d(x,{PricesModule:()=>At});var h=a(9808),g=a(2535),t=a(5e3),d=a(9272),C=a(2260),s=a(3075),f=a(9783),c=a(3710),r=a(6016),l=a(4255),b=a(845),_=a(1424),T=a(7780),M=a(6497);const N=["pricesTable"];function P(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"div",11)(1,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw(),t.MAs(14).clear()}),t.qZA(),t.TgZ(2,"span",13),t._UZ(3,"i",14),t.TgZ(4,"input",15),t.NdJ("input",function(o){return t.CHM(e),t.oxw().filterTableData(o)}),t.qZA()()()}}function I(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"input",24),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw(3).headers.name=o}),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("ngModel",e.headers.name)}}function y(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw(3);t.hij(" ",e.headers.name," ")}}function F(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"input",24),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw(3).headers.pack=o}),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("ngModel",e.headers.pack)}}function J(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw(3);t.hij(" ",e.headers.pack," ")}}function D(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"input",24),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw(3).headers.price=o}),t.qZA()}if(2&n){const e=t.oxw(3);t.Q6J("ngModel",e.headers.price)}}function U(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw(3);t.hij(" ",e.headers.price," ")}}function Y(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"span",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3);return o.onHeaderEditInit(o.headers)}),t.qZA()}}function B(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(3);return o.onHeaderEditSave(o.headers)}),t.qZA()}}function R(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){return t.CHM(e),t.oxw(3).onHeaderEditCancel()}),t.qZA()}}function $(n,u){if(1&n&&(t.TgZ(0,"tr",17)(1,"th")(2,"p-cellEditor"),t.YNc(3,I,1,1,"ng-template",18),t.YNc(4,y,1,1,"ng-template",19),t.qZA()(),t.TgZ(5,"th")(6,"p-cellEditor"),t.YNc(7,F,1,1,"ng-template",18),t.YNc(8,J,1,1,"ng-template",19),t.qZA()(),t.TgZ(9,"th")(10,"p-cellEditor"),t.YNc(11,D,1,1,"ng-template",18),t.YNc(12,U,1,1,"ng-template",19),t.qZA()(),t.TgZ(13,"th")(14,"div")(15,"div",20),t.YNc(16,Y,1,0,"span",21),t.YNc(17,B,1,0,"button",22),t.YNc(18,R,1,0,"button",23),t.qZA()()()()),2&n){const e=t.oxw(2);t.Q6J("pEditableRow",e.headers),t.xp6(16),t.Q6J("ngIf",!e.headersEdit),t.xp6(1),t.Q6J("ngIf",e.headersEdit),t.xp6(1),t.Q6J("ngIf",e.headersEdit)}}function H(n,u){if(1&n&&t.YNc(0,$,19,4,"tr",16),2&n){const e=t.oxw();t.Q6J("ngIf",e.headers)}}function L(n,u){if(1&n&&(t.TgZ(0,"tr",28)(1,"td",29),t._uU(2),t.qZA()()),2&n){const e=u.$implicit;t.xp6(2),t.hij(" ",e.categoryName||"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u043d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0430"," ")}}function q(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"input",24),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().$implicit.name=o}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.name)}}function S(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw().$implicit;t.hij(" ",e.name," ")}}function Q(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"p-inputNumber",34),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().$implicit.coefficient=o}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.coefficient)("required",!0)}}function k(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw().$implicit;t.hij(" ",e.coefficient," ")}}function G(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"p-inputNumber",34),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().$implicit.price=o}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.price)("required",!0)}}function O(n,u){if(1&n&&(t._uU(0),t.ALo(1,"priceConverter")),2&n){const e=t.oxw().$implicit;t.hij(" ",t.Dn7(1,1,e.price,"two","rub")," ")}}function j(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"span",25),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().onRowEditInit(o)}),t.qZA()}}function z(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"button",26),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().onRowEditSave(o)}),t.qZA()}}function K(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"button",27),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(),p=o.$implicit,m=o.rowIndex;return t.oxw().onRowEditCancel(p,m)}),t.qZA()}}function W(n,u){if(1&n&&(t.TgZ(0,"tr",30)(1,"td",31)(2,"p-cellEditor"),t.YNc(3,q,1,1,"ng-template",18),t.YNc(4,S,1,1,"ng-template",19),t.qZA()(),t.TgZ(5,"td",32)(6,"p-cellEditor"),t.YNc(7,Q,1,2,"ng-template",18),t.YNc(8,k,1,1,"ng-template",19),t.qZA()(),t.TgZ(9,"td",33)(10,"p-cellEditor"),t.YNc(11,G,1,2,"ng-template",18),t.YNc(12,O,2,5,"ng-template",19),t.qZA()(),t.TgZ(13,"td")(14,"div")(15,"div",20),t.YNc(16,j,1,0,"span",21),t.YNc(17,z,1,0,"button",22),t.YNc(18,K,1,0,"button",23),t.qZA()()()()),2&n){const i=u.editing;t.Q6J("pEditableRow",u.$implicit),t.xp6(16),t.Q6J("ngIf",!i),t.xp6(1),t.Q6J("ngIf",i),t.xp6(1),t.Q6J("ngIf",i)}}function V(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"span",35)(1,"p-button",36),t.NdJ("onClick",function(){return t.CHM(e),t.oxw().createPriceList()}),t.qZA(),t.TgZ(2,"p-button",37),t.NdJ("onClick",function(){return t.CHM(e),t.oxw().publishPriceList()}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("loading",e.isButtonLoading)}}const X=function(){return["name"]};let tt=(()=>{class n{constructor(e,i,o,p,m){this.productService=e,this.staticData=i,this.fb=o,this.ms=p,this.router=m,this.goods=[],this.headersEdit=!1,this.clonedProducts={},this.editedProducts={},this.isLoading=!1,this.isButtonLoading=!1,this.textGroup=o.group({textTop:[""],textBottom:[""]})}ngOnInit(){this.isLoading=!0,this.staticData.getPriceListText().subscribe(e=>{this.textGroup.patchValue(e)}),this.staticData.getPriceListHeaders().subscribe(e=>{this.headers=e}),this.productService.getItems().subscribe(e=>{this.goods=e.filter(i=>1!==i.categoryId),this.isLoading=!1})}onRowEditInit(e){e.id&&(this.clonedProducts[e.id]=Object.assign({},e))}onRowEditSave(e){e.id&&(delete this.clonedProducts[e.id],this.editedProducts[e.id]=Object.assign({},e))}onRowEditCancel(e,i){e.id&&(this.goods[i]=this.clonedProducts[e.id],delete this.clonedProducts[e.id])}onHeaderEditInit(e){this.clonedHeaders=Object.assign({},e),this.headersEdit=!0}onHeaderEditSave(e){this.clonedHeaders=void 0,this.editedHeaders=e,this.headersEdit=!1}onHeaderEditCancel(){this.headers=this.clonedHeaders,this.clonedHeaders=void 0,this.headersEdit=!1}filterTableData(e){var i;null===(i=this.pricesTable)||void 0===i||i.filterGlobal(e.target.value,"contains")}publishPriceList(){const e=Object.values(this.editedProducts);let i=e.length;this.isButtonLoading=!0;const o=this.textGroup.getRawValue();this.staticData.setPriceListText(o).subscribe(()=>{this.editedHeaders&&this.staticData.setPriceListHeaders(this.editedHeaders).subscribe(),i?e.map(p=>{const m=Object.assign({},p);delete m.categoryId,delete m.categoryName,delete m.sale,delete m.discountCategoryId,this.productService.updateItem(m).subscribe(()=>{i--,0===i&&this.showSuccessMessage()})}):this.showSuccessMessage()})}showSuccessMessage(){this.ms.add({severity:"success",summary:"\u041f\u0443\u0431\u043b\u0438\u043a\u0430\u0446\u0438\u044f \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0430",detail:"\u041f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442 \u043e\u0431\u043d\u043e\u0432\u043b\u0435\u043d"}),this.isButtonLoading=!1}createPriceList(){this.router.navigate(["admin/prices/individual"])}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(d.M),t.Y36(C.v),t.Y36(s.qu),t.Y36(f.ez),t.Y36(g.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["flower-valley-prices"]],viewQuery:function(e,i){if(1&e&&t.Gf(N,5),2&e){let o;t.iGM(o=t.CRH())&&(i.pricesTable=o.first)}},decls:21,vars:7,consts:[["headerTitle","\u041f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442",3,"isAdmin","buttonTemplate"],[3,"formGroup"],["formControlName","textTop"],["formControlName","textBottom"],["sortField","name","sortMode","single","rowGroupMode","subheader","groupRowsBy","categoryId","editMode","row","styleClass","p-table-override","dataKey","id",3,"value","loading","globalFilterFields"],["pricesTable",""],["pTemplate","caption"],["pTemplate","header"],["pTemplate","groupheader"],["pTemplate","body"],["actionsButtons",""],[1,"flex"],["pButton","","label","\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c","icon","pi pi-filter-slash",1,"p-button-outlined",3,"click"],[1,"p-input-icon-left","ml-auto"],[1,"pi","pi-search"],["pInputText","","type","text","placeholder","\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044e",3,"input"],[3,"pEditableRow",4,"ngIf"],[3,"pEditableRow"],["pTemplate","input"],["pTemplate","output"],[1,"edit"],["pInitEditableRow","","class","pi pi-pencil cursor-pointer",3,"click",4,"ngIf"],["pButton","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-text p-button-success p-mr-2",3,"click",4,"ngIf"],["pButton","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-text p-button-danger",3,"click",4,"ngIf"],["pInputText","","type","text","required","",3,"ngModel","ngModelChange"],["pInitEditableRow","",1,"pi","pi-pencil","cursor-pointer",3,"click"],["pButton","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-text","p-button-success","p-mr-2",3,"click"],["pButton","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-text","p-button-danger",3,"click"],["pRowGroupHeader",""],["colspan","4"],[1,"product",3,"pEditableRow"],[1,"product__name"],[1,"product__count"],[1,"product__sum"],[3,"ngModel","required","ngModelChange"],[1,"p-buttonset"],["icon","pi pi-pencil","styleClass","p-button-info","label","\u041f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442 \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0443",3,"onClick"],["icon","pi pi-upload","label","\u041e\u043f\u0443\u0431\u043b\u0438\u043a\u043e\u0432\u0430\u0442\u044c",3,"loading","onClick"]],template:function(e,i){if(1&e&&(t.TgZ(0,"flower-valley-container",0)(1,"div",1)(2,"div")(3,"h4"),t._uU(4,"\u0422\u0435\u043a\u0441\u0442 \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"),t.qZA(),t._UZ(5,"p-editor",2),t.qZA(),t.TgZ(6,"div")(7,"h4"),t._uU(8,"\u0422\u0435\u043a\u0441\u0442 \u0432 \u043a\u043e\u043d\u0446\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"),t.qZA(),t._UZ(9,"p-editor",3),t.qZA()(),t.TgZ(10,"div")(11,"h2"),t._uU(12,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u044f \u0441\u0442\u043e\u043b\u0431\u0446\u043e\u0432"),t.qZA()(),t.TgZ(13,"p-table",4,5),t.YNc(15,P,5,0,"ng-template",6),t.YNc(16,H,1,1,"ng-template",7),t.YNc(17,L,3,1,"ng-template",8),t.YNc(18,W,19,4,"ng-template",9),t.qZA()(),t.YNc(19,V,3,1,"ng-template",null,10,t.W1O)),2&e){const o=t.MAs(20);t.Q6J("isAdmin",!0)("buttonTemplate",o),t.xp6(1),t.Q6J("formGroup",i.textGroup),t.xp6(12),t.Q6J("value",i.goods)("loading",i.isLoading)("globalFilterFields",t.DdM(6,X))}},directives:[c.e,s.JL,s.sg,r.ML,s.JJ,s.u,l.iA,f.jx,b.Hq,_.o,h.O5,l.D$,l.YL,s.Fj,s.Q7,s.On,l.Pv,l.U1,l.wT,l.Z5,T.R,b.zx],pipes:[M.K],styles:[".p-datatable.p-table-override{margin-top:10px}  .p-datatable.p-table-override .p-datatable-thead tr th{font-weight:500;font-size:16px;line-height:100%;text-transform:uppercase}  .p-datatable.p-table-override .p-datatable-tbody tr.p-rowgroup-header td{text-transform:uppercase;font-weight:500;font-size:20px;line-height:100%;padding:1rem}  .p-datatable.p-table-override .p-datatable-tbody tr:not(.p-rowgroup-header).p-rowgroup-header td{border-top:1px solid rgba(0,0,0,.1);font-weight:400;font-size:14px;line-height:100%;text-transform:uppercase;color:#787878;padding-bottom:0}  .p-datatable.p-table-override .p-datatable-tbody tr:not(.p-rowgroup-header) td p-celleditor,   .p-datatable.p-table-override .p-datatable-tbody tr:not(.p-rowgroup-header) td input{width:70%}"]}),n})();var et=a(4128),nt=a(7613),it=a(8563),ot=a(7798),ut=a(3878),A=a(6526);function st(n,u){1&n&&(t.TgZ(0,"tr")(1,"th"),t._uU(2,"\u0422\u043e\u0432\u0430\u0440"),t.qZA(),t.TgZ(3,"th"),t._uU(4,"\u0423\u043f\u0430\u043a\u043e\u0432\u043a\u0430"),t.qZA(),t.TgZ(5,"th"),t._uU(6,"\u0426\u0435\u043d\u0430"),t.qZA(),t.TgZ(7,"th"),t._uU(8,"\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f"),t.qZA()())}function at(n,u){if(1&n&&(t.TgZ(0,"tr",15)(1,"td",16),t._uU(2),t.qZA()()),2&n){const e=u.$implicit;t.xp6(2),t.hij(" ",e.categoryName||"\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u044f \u043d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u0430"," ")}}function ct(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"input",27),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().$implicit.name=o}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.name)}}function pt(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw().$implicit;t.hij(" ",e.name," ")}}function lt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"p-inputNumber",28),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().$implicit.coefficient=o}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.coefficient)("required",!0)}}function rt(n,u){if(1&n&&t._uU(0),2&n){const e=t.oxw().$implicit;t.hij(" ",e.coefficient," ")}}function dt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"p-inputNumber",28),t.NdJ("ngModelChange",function(o){return t.CHM(e),t.oxw().$implicit.price=o}),t.qZA()}if(2&n){const e=t.oxw().$implicit;t.Q6J("ngModel",e.price)("required",!0)}}function _t(n,u){if(1&n&&(t._uU(0),t.ALo(1,"priceConverter")),2&n){const e=t.oxw().$implicit;t.hij(" ",t.Dn7(1,1,e.price,"two","rub")," ")}}function mt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"span",29),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().onRowEditInit(o)}),t.qZA()}}function gt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"button",30),t.NdJ("click",function(){t.CHM(e);const o=t.oxw().$implicit;return t.oxw().onRowEditSave(o)}),t.qZA()}}function ht(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"button",31),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(),p=o.$implicit,m=o.rowIndex;return t.oxw().onRowEditCancel(p,m)}),t.qZA()}}function ft(n,u){if(1&n&&(t.TgZ(0,"tr",17)(1,"td",18)(2,"p-cellEditor"),t.YNc(3,ct,1,1,"ng-template",19),t.YNc(4,pt,1,1,"ng-template",20),t.qZA()(),t.TgZ(5,"td",21)(6,"p-cellEditor"),t.YNc(7,lt,1,2,"ng-template",19),t.YNc(8,rt,1,1,"ng-template",20),t.qZA()(),t.TgZ(9,"td",22)(10,"p-cellEditor"),t.YNc(11,dt,1,2,"ng-template",19),t.YNc(12,_t,2,5,"ng-template",20),t.qZA()(),t.TgZ(13,"td")(14,"div")(15,"div",23),t.YNc(16,mt,1,0,"span",24),t.YNc(17,gt,1,0,"button",25),t.YNc(18,ht,1,0,"button",26),t.qZA()()()()),2&n){const i=u.editing;t.Q6J("pEditableRow",u.$implicit),t.xp6(16),t.Q6J("ngIf",!i),t.xp6(1),t.Q6J("ngIf",i),t.xp6(1),t.Q6J("ngIf",i)}}function bt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"span",32)(1,"p-button",33),t.NdJ("onClick",function(){return t.CHM(e),t.oxw().showPriceList()}),t.qZA(),t.TgZ(2,"p-button",34),t.NdJ("onClick",function(){return t.CHM(e),t.oxw().sendMail()}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(1),t.Q6J("disabled",!e.selectedGoods.length),t.xp6(1),t.Q6J("disabled",e.sendButtonDisabled)("loading",e.sendingMail)}}const xt=function(){return["name"]},Ct=[{path:"",component:tt},{path:"individual",component:(()=>{class n{constructor(e,i,o,p,m,E,v){this.catalogService=e,this.productService=i,this.staticData=o,this.pricesPDFService=p,this.mailService=m,this.messageService=E,this.fb=v,this.catalog=[],this.goods=[],this.clonedProducts={},this.selectedGoods=[],this.selectedCategories=[],this.isLoading=!1,this.sendButtonDisabled=!0,this.sendingMail=!1,this.categoryControl=v.control(""),this.email=v.control("",s.kI.required),this.categoryControl.valueChanges.subscribe(w=>{this.isLoading=!0,this.selectedGoods=[],this.selectedCategories=w,w.map(wt=>{const Nt=this.goods.filter(Pt=>Pt.discountCategoryId===wt.id);this.selectedGoods=this.selectedGoods.concat(Nt)}),this.isLoading=!1}),this.textGroup=v.group({textTop:[""],textBottom:[""]})}set document(e){e&&(this.sendButtonDisabled=!1),this._doc=e}get document(){return this._doc}ngOnInit(){const e=[this.catalogService.getItems(!0),this.productService.getItems()];(0,et.D)(e).subscribe(([i,o])=>{this.catalog=i,this.goods=o.filter(p=>1!==p.categoryId)}),this.pricesPDFService.getGeneratedDocument().subscribe(i=>{this.document=i}),this.staticData.getPriceListText().subscribe(i=>{this.textGroup.patchValue(i)})}onRowEditInit(e){e.id&&(this.clonedProducts[e.id]=Object.assign({},e))}onRowEditSave(e){if(e.id){const i=this.goods.findIndex(o=>o.id===e.id);this.goods[i]=e,delete this.clonedProducts[e.id]}}onRowEditCancel(e,i){e.id&&(this.goods[i]=this.clonedProducts[e.id],delete this.clonedProducts[e.id])}showPriceList(){this.pricesPDFService.generatePriceList(this.selectedCategories,this.selectedGoods,this.textGroup.getRawValue())}sendMail(){if(this.document){if((0,nt.F)(this.email))return;this.sendingMail=!0;const e=new FormData;e.append("email",this.email.value),e.append("priceList",new File([this.document],"\u041f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442 \u0410\u0433\u0440\u043e\u0444\u0438\u0440\u043c\u0430 \u0426\u0432\u0435\u0442\u043e\u0447\u043d\u0430\u044f \u0414\u043e\u043b\u0438\u043d\u0430.pdf")),this.mailService.sendPricesMail(e).subscribe(()=>{this.sendingMail=!1,this.messageService.add({severity:"success",summary:"\u041f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d",detail:`\u041f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442 \u0441 \u0432\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u043c\u0438 \u043f\u043e\u0437\u0438\u0446\u0438\u044f\u043c\u0438 \u043d\u0430\u043f\u0440\u0430\u0432\u043b\u0435\u043d \u043d\u0430 \u043f\u043e\u0447\u0442\u0443 ${this.email.value}`})})}}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(it.a),t.Y36(d.M),t.Y36(C.v),t.Y36(ot.a),t.Y36(ut.Y),t.Y36(f.ez),t.Y36(s.qu))},n.\u0275cmp=t.Xpm({type:n,selectors:[["flower-valley-individual"]],decls:24,vars:12,consts:[["headerTitle","\u0424\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u0430\u0439\u0441-\u043b\u0438\u0441\u0442\u0430",3,"isAdmin","buttonTemplate"],[1,"p-float-label"],["type","text","id","email","pInputText","",3,"formControl"],["for","email"],[1,"p-float-label","w-12"],["styleClass","w-12","inputId","categories","dataKey","id","optionLabel","name","emptyMessage","\u041a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439 \u043d\u0435\u0442","selectedItemsLabel","\u0412\u044b\u0431\u0440\u0430\u043d\u043e \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0439: {0}",3,"options","formControl","maxSelectedLabels","filter"],["for","categories"],[3,"formGroup"],["formControlName","textTop"],["formControlName","textBottom"],["sortField","categoryName","sortMode","single","rowGroupMode","subheader","groupRowsBy","categoryName","editMode","row","styleClass","p-table-override","dataKey","id",3,"value","loading","globalFilterFields"],["pTemplate","header"],["pTemplate","groupheader"],["pTemplate","body"],["actionsButtons",""],["pRowGroupHeader",""],["colspan","4"],[1,"product",3,"pEditableRow"],[1,"product__name"],["pTemplate","input"],["pTemplate","output"],[1,"product__count"],[1,"product__sum"],[1,"edit"],["pInitEditableRow","","class","pi pi-pencil cursor-pointer",3,"click",4,"ngIf"],["pButton","","type","button","pSaveEditableRow","","icon","pi pi-check","class","p-button-rounded p-button-text p-button-success p-mr-2",3,"click",4,"ngIf"],["pButton","","type","button","pCancelEditableRow","","icon","pi pi-times","class","p-button-rounded p-button-text p-button-danger",3,"click",4,"ngIf"],["pInputText","","type","text","required","",3,"ngModel","ngModelChange"],[3,"ngModel","required","ngModelChange"],["pInitEditableRow","",1,"pi","pi-pencil","cursor-pointer",3,"click"],["pButton","","type","button","pSaveEditableRow","","icon","pi pi-check",1,"p-button-rounded","p-button-text","p-button-success","p-mr-2",3,"click"],["pButton","","type","button","pCancelEditableRow","","icon","pi pi-times",1,"p-button-rounded","p-button-text","p-button-danger",3,"click"],[1,"p-buttonset"],["icon","pi pi-eye","styleClass","p-button-info","label","\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c",3,"disabled","onClick"],["icon","pi pi-upload","label","\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u043a\u043b\u0438\u0435\u043d\u0442\u0443",3,"disabled","loading","onClick"]],template:function(e,i){if(1&e&&(t.TgZ(0,"flower-valley-container",0)(1,"span",1),t._UZ(2,"input",2),t.TgZ(3,"label",3),t._uU(4,"Email \u043a\u043b\u0438\u0435\u043d\u0442\u0430"),t.qZA()(),t.TgZ(5,"span",4),t._UZ(6,"p-multiSelect",5),t.TgZ(7,"label",6),t._uU(8,"\u0412\u043a\u043b\u044e\u0447\u0438\u0442\u044c \u043a\u0430\u0442\u0435\u0433\u043e\u0440\u0438\u0438"),t.qZA()(),t.TgZ(9,"div",7)(10,"div")(11,"h4"),t._uU(12,"\u0422\u0435\u043a\u0441\u0442 \u0432 \u043d\u0430\u0447\u0430\u043b\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"),t.qZA(),t._UZ(13,"p-editor",8),t.qZA(),t.TgZ(14,"div")(15,"h4"),t._uU(16,"\u0422\u0435\u043a\u0441\u0442 \u0432 \u043a\u043e\u043d\u0446\u0435 \u0434\u043e\u043a\u0443\u043c\u0435\u043d\u0442\u0430"),t.qZA(),t._UZ(17,"p-editor",9),t.qZA()(),t.TgZ(18,"p-table",10),t.YNc(19,st,9,0,"ng-template",11),t.YNc(20,at,3,1,"ng-template",12),t.YNc(21,ft,19,4,"ng-template",13),t.qZA()(),t.YNc(22,bt,3,3,"ng-template",null,14,t.W1O)),2&e){const o=t.MAs(23);t.Q6J("isAdmin",!0)("buttonTemplate",o),t.xp6(2),t.Q6J("formControl",i.email),t.xp6(4),t.Q6J("options",i.catalog)("formControl",i.categoryControl)("maxSelectedLabels",4)("filter",!1),t.xp6(3),t.Q6J("formGroup",i.textGroup),t.xp6(9),t.Q6J("value",i.selectedGoods)("loading",i.isLoading)("globalFilterFields",t.DdM(11,xt))}},directives:[c.e,s.Fj,_.o,s.JJ,s.oH,A.NU,s.JL,s.sg,r.ML,s.u,l.iA,f.jx,l.Z5,l.D$,l.YL,s.Q7,s.On,T.R,h.O5,l.Pv,b.Hq,l.U1,l.wT,b.zx],pipes:[M.K],styles:[""]}),n})()}];let Tt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[g.Bz.forChild(Ct)],g.Bz]}),n})();var vt=a(3275),Et=a(4466),Zt=a(5351),Mt=a(2993);let At=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[h.ez,Tt,l.U$,vt.D,Mt.L,s.u5,_.j,b.hJ,Et.f,Zt.l,A.q4,s.UX,r.Z_]]}),n})()}}]);