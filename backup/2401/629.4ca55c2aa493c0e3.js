"use strict";(self.webpackChunkflowervalley=self.webpackChunkflowervalley||[]).push([[629],{4752:(O,b,r)=>{r.d(b,{k:()=>y});var e=r(695),_=r(5e3);let y=(()=>{class h extends e._{constructor(){super(...arguments),this.apiUrl="box"}getItems(){return this.http.get(`${this.baseUrl}/${this.apiUrl}/list`)}}return h.\u0275fac=function(){let v;return function(c){return(v||(v=_.n5z(h)))(c||h)}}(),h.\u0275prov=_.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},3878:(O,b,r)=>{r.d(b,{Y:()=>v});var e=r(2340),_=r(5e3),y=r(520),h=r(2260);let v=(()=>{class m{constructor(o,t){this.http=o,this.staticData=t,this.baseUrl=e.N.baseUrl,this.apiUrl="mails",this.signature="",this.individualText="",this.businessText="",this.businessNotificationText="",t.getMailTexts().subscribe(s=>{this.individualText=s.individualText,this.businessText=s.businessText,this.signature=s.signature,this.businessNotificationText=s.businessNotificationText})}sendIndividualMail(o,t){return this.sendCopyToAdmin(!1,o,t),o.append("sign",this.signature),o.append("text",this.individualText),this.http.post(`${this.baseUrl}/${this.apiUrl}/individual`,o)}sendBusinessMail(o,t,s){return this.sendCopyToAdmin(!0,o,t,s),o.append("sign",this.signature),o.append("text",this.businessText),this.http.post(`${this.baseUrl}/${this.apiUrl}/business`,o)}sendBusinessNotificationMail(o){this.sendAdminNotificationMail(o).subscribe();const t=new FormData;return t.append("orderId",o.id.toString()),t.append("email",o.clientEmail),t.append("sign",this.signature),t.append("text",this.businessNotificationText),this.http.post(`${this.baseUrl}/${this.apiUrl}/business-notification`,t)}sendEditOrderMail(o){return this.http.post(`${this.baseUrl}/${this.apiUrl}/edit-order`,o)}sendAdminMail(o){return this.http.post(`${this.baseUrl}/${this.apiUrl}/admin`,o)}sendAdminNotificationMail(o){const t=new FormData;return t.append("orderId",o.id.toString()),t.append("contactName",o.clientName),t.append("contactPhone",o.clientPhone),t.append("contactEmail",o.clientEmail),t.append("contactAddress",o.clientAddress),this.http.post(`${this.baseUrl}/${this.apiUrl}/admin-notification`,t)}sendPricesMail(o){return o.append("sign",this.signature),this.http.post(`${this.baseUrl}/${this.apiUrl}/price-list`,o)}sendCopyToAdmin(o,t,s,a){const d=new FormData;d.append("isBusiness",`${o}`),d.append("sum",s.orderSum.toString()),d.append("orderId",s.id.toString()),d.append("accountNumber",s.accountNumber||""),d.append("clientName",a||s.clientName),d.append("contactName",s.clientName),d.append("contactPhone",s.clientPhone),d.append("contactEmail",s.clientEmail),d.append("contactAddress",s.clientAddress);const i=t.get("file");i&&d.append("file",i),this.sendAdminMail(d).subscribe()}}return m.\u0275fac=function(o){return new(o||m)(_.LFG(y.eN),_.LFG(h.v))},m.\u0275prov=_.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()},9274:(O,b,r)=>{r.d(b,{p:()=>y});var e=r(695),_=r(5e3);let y=(()=>{class h extends e._{constructor(){super(...arguments),this.apiUrl="order"}getItems(m,c,o){return this.http.get(`${this.baseUrl}/${this.apiUrl}/list?skip=${m}&take=${c}${o?"&searchString="+o:""}`)}generateInvoiceGoods(m){const c=new Map,o=[];return m.forEach(t=>{const s=t.categories[0].id,a=c.get(s);a?a.find(i=>i.price===t.price)?a.push(t):c.set(t.id,[t]):c.set(s,[t])}),c.forEach(t=>{const a=(t[0].categories[0].name.toLowerCase().includes("\u0442\u044e\u043b\u044c\u043f\u0430\u043d")?"\u0422\u044e\u043b\u044c\u043f\u0430\u043d\u044b \u043e\u043f\u0442\u043e\u043c":t[0].categories[0].name)+" (\u0432 \u0430\u0441\u0441\u043e\u0440\u0442\u0438\u043c\u0435\u043d\u0442\u0435)",d=t[0].price,i=t[0].volume;let l=0;t.map(u=>{l+=u.count}),o.push({name:a,count:l,volume:i,price:d})}),o}generateOrderProducts(m){const c=new Map,o=[];return m.forEach(t=>{const s=t.product.categories[0].id,a=c.get(s);a?a.find(i=>i.price===t.price)?a.push(t):c.set(t.id,[t]):c.set(s,[t])}),c.forEach(t=>{const s=t[0].product.categories[0].name+" (\u0432 \u0430\u0441\u0441\u043e\u0440\u0442\u0438\u043c\u0435\u043d\u0442\u0435)",a=t[0].price,d=t[0].product.volume;let i=0;t.map(l=>{i+=l.count}),o.push({name:s,count:i,volume:d,price:a})}),o}generateInvoiceBoxes(m){const c=new Map,o=[];return m.forEach(t=>{const s=t.price,a=c.get(s);a?a.push(t):c.set(s,[t])}),c.forEach(t=>{const a=t[0].price;let d=0;t.map(i=>{d+=i.count}),o.push({name:"\u0422\u0440\u0430\u043d\u0441\u043f\u043e\u0440\u0442\u0438\u0440\u043e\u0432\u043e\u0447\u043d\u0430\u044f \u043a\u043e\u0440\u043e\u0431\u043a\u0430 (\u0432 \u0430\u0441\u0441\u043e\u0440\u0442\u0438\u043c\u0435\u043d\u0442\u0435)",count:d,price:a})}),o}}return h.\u0275fac=function(){let v;return function(c){return(v||(v=_.n5z(h)))(c||h)}}(),h.\u0275prov=_.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},8812:(O,b,r)=>{r.d(b,{r:()=>h});var e=r(1135),_=r(5e3),y=r(4752);let h=(()=>{class v{constructor(c){this.boxService=c,this._boxesUpdate=new e.X([]),this._boxes=[]}get boxes(){return this._boxes}set boxes(c){this._boxes=c,this._boxesUpdate.next(c)}genBoxes(c){const o=[];this.boxService.getItems().subscribe(t=>{t.map(s=>{let a=s.volume;const d=c.filter(i=>i.boxId===s.id);null==d||d.map(i=>{const l=o.find(u=>u.id===s.id);if(i.count/s.volume<1)if(l)if(a){const u=i.count-a;if(u<0)a=s.volume-Math.abs(u);else if(u>0){const f=Math.ceil(u/l.volume);l.count+=f,a=f-u}}else l.count++,a=s.volume;else o.push(Object.assign(Object.assign({},s),{count:1})),a=s.volume-i.count;else if(i.count/s.volume>1)if(l)if(a){i.count=i.count-a;const u=Math.ceil(i.count/l.volume);l.count+=u,a=u*l.volume-i.count}else{const u=Math.ceil(i.count/l.volume);l.count+=u,a=u*l.volume-i.count}else{const u=Math.ceil(i.count/s.volume);o.push(Object.assign(Object.assign({},s),{count:u})),a=u*s.volume-i.count}else l?l.count++:o.push(Object.assign(Object.assign({},s),{count:1}))})}),this.boxes=o})}removeBoxes(){this.boxes=[]}getBoxes(){return this._boxesUpdate.asObservable()}getBoxesSum(){let c=0;return this.boxes.map(o=>c+=o.price*o.count),c}}return v.\u0275fac=function(c){return new(c||v)(_.LFG(y.k))},v.\u0275prov=_.Yz7({token:v,factory:v.\u0275fac}),v})()},3248:(O,b,r)=>{r.d(b,{M:()=>m});var e=r(4004),_=r(5e3),y=r(6827),h=r(7216),v=r(6497);let m=(()=>{class c{constructor(t,s,a){this.estimatePDF=t,this.offerPDF=s,this.priceConvert=a}getOffer(t,s){let a="";a+=s.FullName,a+=`, ${s.Address}`,a+=`, \u0418\u041d\u041d: ${s.INN}`,s.KPP&&(a+=`, \u041a\u041f\u041f: ${s.KPP}`);const d=t.id,i=new Date(t.orderDate).toLocaleDateString()+"\u0433.";let l=0;const u=t.products.sort((f,D)=>f.product.categoryId-D.product.categoryId).map(f=>(l+=f.count*f.price,[f.product.name,"\u0448\u0442.",f.count,this.priceConvert.transform(f.price,"two","none"),this.priceConvert.transform(f.count*f.price,"two","none")]));return t.deliveryPrice&&(l+=t.deliveryPrice,u.push(["\u0414\u043e\u0441\u0442\u0430\u0432\u043a\u0430","-",1,this.priceConvert.transform(t.deliveryPrice,"two","none"),this.priceConvert.transform(t.deliveryPrice,"two","none")])),this.offerPDF.getPDF(d,i,a,u,l,!1),this.offerPDF.getGeneratedDocument().pipe((0,e.U)(f=>new File([f],"\u041a\u043e\u043c\u043c\u0435\u0440\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435.pdf")))}getEstimate(t){const s=[];let a=0;return t.boxes.map(d=>{s.push({name:d.box.name,price:d.price,count:d.count})}),this.estimatePDF.getClientPDF(t.products.sort((d,i)=>d.product.categoryId-i.product.categoryId).map(d=>(a+=d.price*d.count,[d.product.name,d.price,d.count,d.price*d.count])),this.priceConvert.transform(t.deliveryPrice,"two","none"),s,this.priceConvert.transform(a,"two","rub"),this.priceConvert.transform(t.orderSum,"two","none"),t,!1).pipe((0,e.U)(d=>new File([d],`\u0421\u043c\u0435\u0442\u0430 \u043f\u043e \u0437\u0430\u043a\u0430\u0437\u0443 \u2116${t.id}.pdf`)))}}return c.\u0275fac=function(t){return new(t||c)(_.LFG(y.h),_.LFG(h.u),_.LFG(v.K))},c.\u0275prov=_.Yz7({token:c,factory:c.\u0275fac,providedIn:null}),c})()},6827:(O,b,r)=>{r.d(b,{h:()=>y});var e=r(5e3),_=r(9809);let y=(()=>{class h{constructor(m){this.htmlToPdf=m,this.header=["\u0422\u043e\u0432\u0430\u0440","\u0426\u0435\u043d\u0430 \u20bd","\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e","\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c \u20bd"]}getClientPDF(m,c,o,t,s,a,d=!0){return this.htmlToPdf.getPDF(!0,this.header,m,c,o,t,s,a,void 0,void 0,d),this.htmlToPdf.getGeneratedDocument()}getCompanyPDF(m,c,o,t,s,a,d,i,l=!0){return this.htmlToPdf.getPDF(!1,this.header,m,c,o,t,s,a,d||void 0,i,l),this.htmlToPdf.getGeneratedDocument()}}return h.\u0275fac=function(m){return new(m||h)(e.LFG(_.F))},h.\u0275prov=e.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},7216:(O,b,r)=>{r.d(b,{u:()=>s});var e=r(9809),_=r(4641),y=r.n(_),h=r(8493),v=r(7429),m=r.n(v),c=r(7579),o=r(330),t=r(5e3);y().vfs=h.I.vfs;let s=(()=>{class a{constructor(i){this.priceConvert=i,this._generatedDocument=new c.x}getPDF(i,l,u,f,D,x=!0){this.orderNumber=i,this.date=l,this.client=u,this.content=f,this.sum=D,e.F.getBase64ImageFromURL("assets/images/logo.png").then(E=>{e.F.getBase64ImageFromURL("assets/images/sign.png").then(A=>{const M={content:m()(this.generateHTML(E,A).innerHTML,{tableAutoSize:!0}),info:{title:"\u041a\u043e\u043c\u043c\u0435\u0440\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435"}},C=y().createPdf(M);x&&C.open(),C.getBlob(U=>{this._generatedDocument.next(U)})})})}generateHTML(i,l){const u=document.createElement("div"),f=a.genHeaderTable(i);u.append(f);const D=this.genBodyTitle();u.append(D);const x=this.genBodyTable();u.append(x);const E=a.genFooterTable(l);return u.append(E),u}static genHeaderTable(i){const l=document.createElement("img");"string"==typeof i&&(l.setAttribute("src",i),l.setAttribute("width","150"));const u=document.createElement("table");u.style.border="0";const f=u.createTHead(),D=u.createTBody(),x=f.insertRow(0),E=x.insertCell(0),A=x.insertCell(1);E.style.width="25%",E.style.border="0",A.style.width="75%",A.style.border="0";const P=D.insertRow(0),M=D.insertRow(1),C=D.insertRow(2),U=D.insertRow(3),w=P.insertCell(0);w.rowSpan=4,w.append(l),w.style.border="0";const I=P.insertCell(1);I.innerHTML=this.getTitleText(),I.style.border="0";const F=M.insertCell(0);F.innerHTML=this.getAddress(),F.style.fontSize="10px",F.style.border="0";const Z=C.insertCell(0);Z.innerHTML=this.getContacts(),Z.style.fontSize="10px",Z.style.border="0";const p=U.insertCell(0);p.innerHTML=this.getPaymentText(),p.style.border="0",p.style.fontSize="10px";const n=D.insertRow(4).insertCell(0);return n.colSpan=2,n.style.borderLeft="0",n.style.borderRight="0",u}static getPaymentText(){return"<b>\u0418\u041f \u0411\u043e\u043b\u044c\u0448\u0430\u043a\u043e\u0432 \u041e\u043b\u0435\u0433 \u0412\u0430\u043b\u0435\u043d\u0442\u0438\u043d\u043e\u0432\u0438\u0447 \u0418\u041d\u041d - 771601384607 \u041e\u0413\u0420\u041d\u0418\u041f \u2013 307770000627581<br/>\n            \u0410\u0434\u0440\u0435\u0441 - 129323, \u041c\u043e\u0441\u043a\u0432\u0430, \u0443\u043b.\u0421\u0435\u0434\u043e\u0432\u0430, \u0434\u043e\u043c 2, \u043a\u043e\u0440\u043f.2, \u043e\u0444.56<br/>\n            \u0411\u0418\u041a - 044525225 \u0411\u0430\u043d\u043a - \u041f\u0410\u041e \u0421\u0431\u0435\u0440\u0431\u0430\u043d\u043a \u0433. \u041c\u043e\u0441\u043a\u0432\u0430 \u0420/\u0421 \u2013 40802810277010000460 \u041a/\u0421 - 30101810145250000411</b>"}static getTitleText(){const i=document.createElement("b");i.innerHTML="\u0410\u0433\u0440\u043e\u0444\u0438\u0440\u043c\u0430 \u0426\u0432\u0435\u0442\u043e\u0447\u043d\u0430\u044f \u0414\u043e\u043b\u0438\u043d\u0430<br/>",i.style.fontSize="20px";const l=document.createElement("span");l.innerHTML="\u0422\u0435\u043f\u043b\u0438\u0447\u043d\u043e\u0435 \u0445\u043e\u0437\u044f\u0439\u0441\u0442\u0432\u043e",l.style.color="grey";const u=document.createElement("div");return u.append(i,l),u.innerHTML}static getContacts(){return"<b>\u041f\u043e\u0447\u0442\u0430 - flowervalley@mail.ru  \u0422\u0435\u043b. \u2013 +7 (915) 109 10 00</b>"}static getAddress(){return"<b>\u0410\u0434\u0440\u0435\u0441 - 140125, \u041c\u043e\u0441\u043a. \u043e\u0431\u043b., \u0420\u0430\u043c\u0435\u043d\u0441\u043a\u0438\u0439 \u0440-\u043d., \u0434. \u041e\u0441\u0442\u0440\u043e\u0432\u0446\u044b, \u0443\u043b. \u041f\u043e\u0434\u043c\u043e\u0441\u043a\u043e\u0432\u043d\u0430\u044f \u0434. 22 A \u0442\u0435\u043f\u043b\u0438\u0446\u0430 109</b>"}genBodyTitle(){const i=document.createElement("table"),l=i.createTHead(),u=i.createTBody(),D=l.insertRow(0).insertCell(0);D.style.width="100%",D.style.border="0";const E=u.insertRow(0).insertCell(0);E.innerHTML=`<b>\u2116${this.orderNumber} \u043e\u0442 ${this.date}</b>`,E.style.border="0",a.insertSpaceRow(1,u,1);const P=u.insertRow(2).insertCell(0);P.innerHTML=`<b>${this.client}</b>`,P.style.border="0",a.insertSpaceRow(4,u,3);const C=u.insertRow(4).insertCell(0);C.innerHTML="<b>\u041a\u043e\u043c\u043c\u0435\u0440\u0447\u0435\u0441\u043a\u043e\u0435 \u043f\u0440\u0435\u0434\u043b\u043e\u0436\u0435\u043d\u0438\u0435</b>",C.style.border="0",C.style.fontSize="24px",C.style.textAlign="center",a.insertSpaceRow(1,u,5);const w=u.insertRow(6).insertCell(0);return w.innerHTML="\u041c\u044b \u0433\u043e\u0442\u043e\u0432\u044b \u043f\u043e\u0441\u0442\u0430\u0432\u0438\u0442\u044c \u0441\u043b\u0435\u0434\u0443\u044e\u0449\u0438\u0435 \u0442\u043e\u0432\u0430\u0440\u044b, \u0438\u0441\u0445\u043e\u0434\u044f \u0438\u0437 \u0441\u043f\u0438\u0441\u043a\u0430 \u0412\u0430\u0448\u0435\u0439 \u0437\u0430\u044f\u0432\u043a\u0438.",w.style.border="0",w.style.fontSize="14px",w.style.textAlign="center",a.insertSpaceRow(1,u,7),i}genBodyTable(){const i=["\u2116","\u0422\u043e\u0432\u0430\u0440","\u0415\u0434.","\u041a\u043e\u043b-\u0432\u043e","\u0426\u0435\u043d\u0430, \u20bd","\u0421\u0443\u043c\u043c\u0430, \u20bd"],l=document.createElement("table"),u=l.createTHead(),f=l.createTBody(),D=u.insertRow(0);for(let M=0;M<i.length;M++){const C=D.insertCell(M);switch(C.innerHTML=i[M],M){case 0:case 2:C.style.width="5%";break;case 1:C.style.width="45%";break;case 3:C.style.width="10%";break;default:C.style.width="17.5%"}C.style.textAlign="center",C.style.fontWeight="bold"}for(let M=0;M<this.content.length;M++){const C=this.content[M],U=f.insertRow(M),w=U.insertCell(0);w.innerHTML=`${M+1}`,w.style.textAlign="center";for(let I=0;I<C.length;I++){const F=U.insertCell(I+1);F.innerHTML=`${C[I]}`,I>0&&(F.style.textAlign="center")}}const x=f.insertRow(this.content.length),E=x.insertCell(0);E.colSpan=4,E.style.border="0",x.insertCell(1).innerHTML="<b>\u0418\u0442\u043e\u0433\u043e:</b>";const P=x.insertCell(2);return P.innerHTML=this.priceConvert.transform(this.sum,"two","rub"),P.style.textAlign="center",l}static genFooterTable(i){const l=document.createElement("img");"string"==typeof i&&(l.setAttribute("src",i),l.setAttribute("width","600"));const u=document.createElement("table");u.style.border="0";const f=u.createTHead(),D=u.createTBody(),E=f.insertRow(0).insertCell(0);E.style.width="100%",E.style.border="0";const P=D.insertRow(0).insertCell(0);return P.style.border="0",P.style.textAlign="center",P.append(l),u}static insertSpaceRow(i,l,u,f){const x=l.insertRow(u).insertCell(0);f&&(x.colSpan=f),x.style.border="0";let E="";for(let A=0;A<i;A++)E+="<br/>";x.innerHTML=E}getGeneratedDocument(){return this._generatedDocument.asObservable()}}return a.\u0275fac=function(i){return new(i||a)(t.LFG(o.H))},a.\u0275prov=t.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})()},7613:(O,b,r)=>{r.d(b,{F:()=>y});var e=r(3075);function _(h){!h||(h instanceof e.NI?h.markAsDirty():Object.keys(h.controls).map(v=>{const m=h.get(v);(null==m?void 0:m.invalid)&&(m instanceof e.Oe&&m.controls.map(c=>{_(c)}),m instanceof e.cw&&_(m),null==m||m.markAsDirty())}))}function y(h){return!!(null==h?void 0:h.invalid)&&(_(h),!0)}},3058:(O,b,r)=>{r.d(b,{c:()=>Z});var e=r(5e3),_=r(3075),y=r(5698),h=r(5995),v=r(2340),m=r(520);let c=(()=>{class p{constructor(n){this.http=n,this.url=v.N.dadataUrl}getFirmByINN(n){return this.http.post(this.url+"/findById/party",{query:n})}getBank(n){return this.http.post(this.url+"/suggest/bank",{query:n})}}return p.\u0275fac=function(n){return new(n||p)(e.LFG(m.eN))},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})(),o=(()=>{class p{convertToFirm(n){return{FullName:n.data.name.full_with_opf,ShortName:n.data.name.short_with_opf,Address:n.data.address.unrestricted_value,INN:n.data.inn,KPP:n.data.kpp}}convertToBank(n){return{BIK:n.data.bic,Bank:n.value,CorDep:n.data.correspondent_account}}getAutocompleteBankItem(n){return{value:n.Bank,data:{bic:n.BIK,correspondent_account:n.CorDep}}}}return p.\u0275fac=function(n){return new(n||p)},p.\u0275prov=e.Yz7({token:p,factory:p.\u0275fac,providedIn:"root"}),p})();var t=r(9808),s=r(1208),a=r(2145),d=r(9783),i=r(1424),l=r(3787);const u=["autoCompleteBank"];function f(p,T){if(1&p&&(e.TgZ(0,"b"),e._uU(1,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435:"),e.qZA(),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"b"),e._uU(5,"\u0418\u041d\u041d:"),e.qZA(),e.TgZ(6,"div"),e._uU(7),e.qZA()),2&p){const n=T.$implicit;e.xp6(3),e.Oqu(n.value),e.xp6(4),e.Oqu(n.data.inn)}}function D(p,T){1&p&&(e.TgZ(0,"label",9),e._uU(1,"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0418\u041d\u041d \u0434\u043b\u044f \u043f\u043e\u0438\u0441\u043a\u0430"),e.qZA())}function x(p,T){1&p&&(e.TgZ(0,"label",9),e._uU(1,"\u0418\u041d\u041d"),e.qZA())}function E(p,T){if(1&p){const n=e.EpF();e.TgZ(0,"span",5)(1,"p-autoComplete",6),e.NdJ("onSelect",function(B){return e.CHM(n),e.oxw().patchDaDataClientValue(B)})("completeMethod",function(B){return e.CHM(n),e.oxw().searchClientByDaData(B.query)}),e.YNc(2,f,8,2,"ng-template",7),e.qZA(),e.YNc(3,D,2,0,"label",8),e.YNc(4,x,2,0,"label",8),e.qZA()}if(2&p){const n=e.oxw();e.xp6(1),e.Q6J("suggestions",n.daDataClientResults)("showEmptyMessage",!0)("delay",1e3),e.xp6(2),e.Q6J("ngIf",!n.isShowForm),e.xp6(1),e.Q6J("ngIf",n.isShowForm)}}function A(p,T){if(1&p&&(e.TgZ(0,"b"),e._uU(1,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435:"),e.qZA(),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"b"),e._uU(5,"\u0418\u041d\u041d:"),e.qZA(),e.TgZ(6,"div"),e._uU(7),e.qZA()),2&p){const n=T.$implicit;e.xp6(3),e.Oqu(n.FullName),e.xp6(4),e.Oqu(n.INN)}}function P(p,T){1&p&&(e.TgZ(0,"label",9),e._uU(1,"\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0431\u0430\u0437\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432"),e.qZA())}function M(p,T){1&p&&(e.TgZ(0,"label",9),e._uU(1,"\u0418\u041d\u041d (\u043f\u043e\u0438\u0441\u043a \u043f\u043e \u0431\u0430\u0437\u0435 \u043a\u043b\u0438\u0435\u043d\u0442\u043e\u0432)"),e.qZA())}function C(p,T){if(1&p){const n=e.EpF();e.TgZ(0,"span",5)(1,"p-autoComplete",10),e.NdJ("onSelect",function(B){return e.CHM(n),e.oxw().patchBpValue(B)})("completeMethod",function(B){return e.CHM(n),e.oxw().searchClientByBP(B.query)}),e.YNc(2,A,8,2,"ng-template",7),e.qZA(),e.YNc(3,P,2,0,"label",8),e.YNc(4,M,2,0,"label",8),e.qZA()}if(2&p){const n=e.oxw();e.xp6(1),e.Q6J("suggestions",n.businessPackResults)("showEmptyMessage",!0),e.xp6(2),e.Q6J("ngIf",!n.isShowForm),e.xp6(1),e.Q6J("ngIf",n.isShowForm)}}function U(p,T){if(1&p&&(e.TgZ(0,"b"),e._uU(1,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435:"),e.qZA(),e.TgZ(2,"div"),e._uU(3),e.qZA(),e.TgZ(4,"b"),e._uU(5,"\u0411\u0418\u041a:"),e.qZA(),e.TgZ(6,"div"),e._uU(7),e.qZA()),2&p){const n=T.$implicit;e.xp6(3),e.Oqu(n.value),e.xp6(4),e.Oqu(n.data.bic)}}function w(p,T){1&p&&(e.ynx(0),e.TgZ(1,"span",5),e._UZ(2,"input",36),e.TgZ(3,"label",37),e._uU(4,"\u0411\u0430\u043d\u043a"),e.qZA()(),e.TgZ(5,"span",5),e._UZ(6,"input",38),e.TgZ(7,"label",39),e._uU(8,"\u041a\u043e\u0440. \u0441\u0447\u0435\u0442"),e.qZA()(),e.TgZ(9,"span",5),e._UZ(10,"input",40),e.TgZ(11,"label",41),e._uU(12,"\u0420\u0430\u0441\u0447\u0435\u0442\u043d\u044b\u0439 \u0441\u0447\u0435\u0442"),e.qZA()(),e.BQk())}function I(p,T){if(1&p){const n=e.EpF();e.TgZ(0,"form",11)(1,"span",5),e._UZ(2,"input",12),e.TgZ(3,"label",13),e._uU(4,"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438"),e.qZA()(),e.TgZ(5,"span",5),e._UZ(6,"input",14),e.TgZ(7,"label",15),e._uU(8,"\u041f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c"),e.qZA()(),e.TgZ(9,"span",5),e._UZ(10,"input",16),e.TgZ(11,"label",17),e._uU(12,"\u0410\u0434\u0440\u0435\u0441 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438"),e.qZA()(),e.TgZ(13,"p-accordion")(14,"p-accordionTab",18)(15,"span",5)(16,"p-autoComplete",19,20),e.NdJ("onSelect",function(B){return e.CHM(n),e.oxw().patchDaDataBankValue(B)})("completeMethod",function(B){return e.CHM(n),e.oxw().searchBankByName(B.query)}),e.YNc(18,U,8,2,"ng-template",7),e.qZA(),e.TgZ(19,"label",9),e._uU(20),e.qZA()(),e.YNc(21,w,13,0,"ng-container",21),e.TgZ(22,"span",5),e._UZ(23,"input",22),e.TgZ(24,"label",23),e._uU(25,"\u041a\u041f\u041f"),e.qZA()(),e.TgZ(26,"span",5),e._UZ(27,"input",24),e.TgZ(28,"label",25),e._uU(29,"\u041e\u041a\u041f\u041e"),e.qZA()(),e.TgZ(30,"span",5),e._UZ(31,"input",26),e.TgZ(32,"label",27),e._uU(33,"\u041f\u043e\u043b\u043d\u043e\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438"),e.qZA()(),e.TgZ(34,"span",5),e._UZ(35,"input",28),e.TgZ(36,"label",29),e._uU(37,"\u041b\u0438\u0446\u0435\u0432\u043e\u0439 \u0441\u0447\u0435\u0442"),e.qZA()(),e.TgZ(38,"span",5),e._UZ(39,"input",30),e.TgZ(40,"label",31),e._uU(41,"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u0430\u044f \u043f\u043e\u0447\u0442\u0430 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438"),e.qZA()(),e.TgZ(42,"span",5),e._UZ(43,"input",32),e.TgZ(44,"label",33),e._uU(45,"\u0422\u0435\u043b\u0435\u0444\u043e\u043d \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438"),e.qZA()(),e.TgZ(46,"span",5),e._UZ(47,"input",34),e.TgZ(48,"label",35),e._uU(49,"\u0421\u0430\u0439\u0442 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438"),e.qZA()()()()()}if(2&p){const n=e.oxw();e.Q6J("formGroup",n.entityData),e.xp6(16),e.Q6J("suggestions",n.daDataBankResults)("showEmptyMessage",!0)("delay",1e3),e.xp6(4),e.Oqu(n.entityData.controls.BIK.value?"\u0411\u0418\u041a":"\u041f\u043e\u0438\u0441\u043a \u043f\u043e \u0411\u0438\u043a/\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u044e \u0431\u0430\u043d\u043a\u0430"),e.xp6(1),e.Q6J("ngIf",!!n.entityData.controls.BIK.value)}}const F=function(p){return{"margin-top":p}};let Z=(()=>{class p{constructor(n,g,B,N){this.fb=n,this.bpService=g,this.dadataService=B,this.dadataConvertService=N,this.newClientLabel="\u042f \u0434\u0435\u043b\u0430\u044e \u0437\u0430\u043a\u0430\u0437 \u0432\u043f\u0435\u0440\u0432\u044b\u0435",this.isNewOrder=!1,this.isShowForm=!1,this.entityDataChanged=!1,this.dataChanges=new e.vpe,this.businessPackResults=[],this.daDataClientResults=[],this.daDataBankResults=[],this.entityData=n.group({FullName:["",_.kI.required],INN:["",_.kI.required],ShortName:["",_.kI.required],Address:["",_.kI.required],NoNDS:[!1,_.kI.required],BIK:[""],Bank:[""],CorDep:[""],RasDep:[""],KPP:[""],OKPO:[""],ExtraName:[""],PersonalDep:[""],OrgEMail:[""],OrgPhone:[""],OrgURL:[""]}),this.entityData.valueChanges.subscribe(()=>{!0===this.isNewClient.value?this.dataChanges.emit(this.entityData):(this.dataChanges.emit({id:this.entityId||"",isChanged:this.entityDataChanged}),this.entityDataChanged&&this.dataChanges.emit(this.entityData))}),this.isNewClient=this.fb.control(!1),this.isNewClient.valueChanges.subscribe(()=>{this.entityData.reset({NoNDS:!1}),this.entityDataChanged=!1,this.isShowForm=!1})}ngOnInit(){this.dataChanges.emit(this.entityData)}patchBpValue(n){this.entityId=n.Object,this.entityData.patchValue(n),this.isShowForm=!0,setTimeout(()=>{var g;null===(g=this.autoCompleteBank)||void 0===g||g.selectItem(this.dadataConvertService.getAutocompleteBankItem(n),!1)}),this.entityData.valueChanges.pipe((0,y.q)(1)).subscribe(()=>{this.entityDataChanged=!0})}patchDaDataClientValue(n){const g=this.dadataConvertService.convertToFirm(n);this.entityData.patchValue(g),this.isShowForm=!0}patchDaDataBankValue(n){const g=this.dadataConvertService.convertToBank(n);this.entityData.patchValue(g)}searchClientByBP(n){this.bpService.searchFirm(n).subscribe(({items:g})=>{this.businessPackResults=g.filter(B=>B.INN)})}searchClientByDaData(n){this.dadataService.getFirmByINN(n).subscribe(({suggestions:g})=>{this.daDataClientResults=g})}searchBankByName(n){this.dadataService.getBank(n).subscribe(({suggestions:g})=>{this.daDataBankResults=g})}}return p.\u0275fac=function(n){return new(n||p)(e.Y36(_.qu),e.Y36(h.k),e.Y36(c),e.Y36(o))},p.\u0275cmp=e.Xpm({type:p,selectors:[["flower-valley-entity-form"]],viewQuery:function(n,g){if(1&n&&e.Gf(u,5),2&n){let B;e.iGM(B=e.CRH())&&(g.autoCompleteBank=B.first)}},inputs:{newClientLabel:"newClientLabel",isNewOrder:"isNewOrder",client:"client"},outputs:{dataChanges:"dataChanges"},decls:7,vars:9,consts:[[1,"p-field-checkbox",3,"ngClass"],["inputId","isNewClient",3,"formControl","binary"],["for","isNewClient"],["class","p-float-label",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"p-float-label"],["styleClass","w-12","emptyMessage","\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e","field","data.inn","inputId","inputtext",3,"suggestions","showEmptyMessage","delay","onSelect","completeMethod"],["pTemplate","item"],["for","inputtext",4,"ngIf"],["for","inputtext"],["styleClass","w-12","emptyMessage","\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e","field","INN","inputId","inputtext",3,"suggestions","showEmptyMessage","onSelect","completeMethod"],[3,"formGroup"],["type","text","id","entityName","pInputText","","formControlName","FullName"],["for","entityName"],["type","text","id","ShortName","pInputText","","formControlName","ShortName"],["for","ShortName"],["type","text","id","Address","pInputText","","formControlName","Address"],["for","Address"],["header","\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u043f\u043e\u043b\u044f"],["styleClass","w-12","emptyMessage","\u0421\u043e\u0432\u043f\u0430\u0434\u0435\u043d\u0438\u0439 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e","field","data.bic","inputId","inputtext",3,"suggestions","showEmptyMessage","delay","onSelect","completeMethod"],["autoCompleteBank",""],[4,"ngIf"],["type","text","id","KPP","pInputText","","formControlName","KPP"],["for","KPP"],["type","text","id","OKPO","pInputText","","formControlName","OKPO"],["for","OKPO"],["type","text","id","ExtraName","pInputText","","formControlName","ExtraName"],["for","ExtraName"],["type","text","id","PersonalDep","pInputText","","formControlName","PersonalDep"],["for","PersonalDep"],["type","text","id","OrgEMail","pInputText","","formControlName","OrgEMail"],["for","OrgEMail"],["type","text","id","OrgPhone","pInputText","","formControlName","OrgPhone"],["for","OrgPhone"],["type","text","id","OrgURL","pInputText","","formControlName","OrgURL"],["for","OrgURL"],["type","text","id","Bank","pInputText","","formControlName","Bank"],["for","Bank"],["type","text","id","CorDep","pInputText","","formControlName","CorDep"],["for","CorDep"],["type","text","id","RasDep","pInputText","","formControlName","RasDep"],["for","RasDep"]],template:function(n,g){1&n&&(e.TgZ(0,"div",0),e._UZ(1,"p-checkbox",1),e.TgZ(2,"label",2),e._uU(3),e.qZA()(),e.YNc(4,E,5,5,"span",3),e.YNc(5,C,5,4,"span",3),e.YNc(6,I,50,6,"form",4)),2&n&&(e.Q6J("ngClass",e.VKq(7,F,g.isNewOrder)),e.xp6(1),e.Q6J("formControl",g.isNewClient)("binary",!0),e.xp6(2),e.Oqu(g.newClientLabel),e.xp6(1),e.Q6J("ngIf",!0===g.isNewClient.value),e.xp6(1),e.Q6J("ngIf",!1===g.isNewClient.value),e.xp6(1),e.Q6J("ngIf",g.isShowForm))},directives:[t.mk,s.XZ,_.JJ,_.oH,t.O5,a.Qc,d.jx,_._Y,_.JL,_.sg,_.Fj,i.o,_.u,l.UQ,l.US],styles:["[_nghost-%COMP%]{width:100%}  .p-accordion{width:100%}@media screen and (min-width: 1024px){  .p-accordion{width:540px}}  .p-accordion .p-accordion-content{padding:10px 0 0;border:none;background:none}.margin-top[_ngcontent-%COMP%]{margin-top:-34px}"]}),p})()},8372:(O,b,r)=>{r.d(b,{b:()=>h});var e=r(4986),_=r(4482),y=r(5403);function h(v,m=e.z){return(0,_.e)((c,o)=>{let t=null,s=null,a=null;const d=()=>{if(t){t.unsubscribe(),t=null;const l=s;s=null,o.next(l)}};function i(){const l=a+v,u=m.now();if(u<l)return t=this.schedule(void 0,l-u),void o.add(t);d()}c.subscribe(new y.Q(o,l=>{s=l,a=m.now(),t||(t=m.schedule(i,v),o.add(t))},()=>{d(),o.complete()},void 0,()=>{s=t=null}))})}}}]);